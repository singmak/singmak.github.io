{"componentChunkName":"component---src-pages-post-mdx-slug-tsx","path":"/post/2021-5-8-turn-express-app-to-lambda-cdk/","result":{"data":{"mdx":{"frontmatter":{"title":"Deploy an AWS Lambda function with AWS CDK","date":"May 8, 2021","description":"How to create a AWS Lambda function with AWS CDK"},"body":"var _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"title\": \"Deploy an AWS Lambda function with AWS CDK\",\n  \"date\": \"2021-05-08\",\n  \"description\": \"How to create a AWS Lambda function with AWS CDK\",\n  \"tags\": [\"aws\", \"lambda\", \"aws-cdk\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"There are many ways to create and configure the infrastructures of our applications on AWS, either it's with the console, AWS CLI or AWS Cloudformation. With AWS CDK, we can create AWS Cloudformation stacks with the power of programming languages. AWS CDK supports multiple programming languages. In this blog post, I am going to demonstrate how to turn a simple Express app API written in Typescript into an AWS Lambda function with AWS CDK.\"), mdx(\"p\", null, \"Using AWS Cloudformation is a good way to maintain our infrastructures as code. However, writing a Cloudformation template is not easy. Most of my experience with AWS Cloudformation is with Serverless Framework because when I deploy an AWS Lambda service with Serverless Framework, it deploys the Lambda service as a Cloudformation stack and we don't need to write a single line of AWS CloudFormation template. It saves us so much work. What's even greater about Serverless Framework is that we can override the generated Cloudformation resources or add additional resources in the stack in the serverless.yml. Outside of Serverless Framework, I mostly just use the AWS console or AWS Cli to manually configure the AWS infrastructure... To be honest I was put off by the huge amount of lines of codes that are required to be written to define a stack in a Cloudformation template and all the template syntax that I need to learn...\"), mdx(\"p\", null, \"But not anymore! Now I know that there's a much easier way to create a Cloudformation stack for developers, which is AWS CDK (AWS Cloud Development Kit). \"), mdx(\"h2\", null, \"Prerequisite\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"AWS CLI environment setup\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Node.js version 14+\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Knowledge of typescript\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Basic knowledge of AWS Lambda\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Knowledge of AWS Lambda\")), mdx(\"h2\", null, \"Starting point\"), mdx(\"p\", null, \"First of all, please download the example project from \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/singmak/cdk-express-example\"\n  }, \"here\"), \".\\nThis tutorial will use the codes in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"starting-point\"), \" folder of this repository as a start point.\"), mdx(\"h2\", null, \"Basic CDK stack setup\"), mdx(\"p\", null, \"Now assume that you have already downloaded the codes of the starting point project.\"), mdx(\"p\", null, \"First of all, we need to install AWS CDK:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"npm install -g aws-cdk\\ncdk --version\\n\")), mdx(\"p\", null, \"Now unzip the downloaded package and go to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"starting-point\"), \" folder of the unzipped package in the shell.\"), mdx(\"p\", null, \"Create a CDK folder for separating application codes from the CDK stack codes.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"mkdir cdk\\ncd cdk\\n\")), mdx(\"p\", null, \"Initialize AWS CDK stack with TypeScript template\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"cdk init app --language typescript\\n\")), mdx(\"p\", null, \"Install the dependencies for creating the Lambda function and API Gateway resources in the stack.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"npm i @aws-cdk/aws-apigateway @aws-cdk/aws-lambda\\n\")), mdx(\"p\", null, \"The project should look like this at this point\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./images/cdk-express-project-structure.png\"\n  }, mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"227px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"219.3832599118943%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAYAAABloJjNAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE3UlEQVRIx51X23bbNhDUh7SxRYIgbgQIkpJ4l2Q7dhLHTpw0aZuHnvQH+v9v04Ol5SankU3nYQXJEpfD2Znd9SJJOIw2EFpDb9dQtQeLGMLffyYW4UVLDeEz2Nc95DoHW04JGUuen5Au4hxGGciNhx5X9Pnwg+cmpYScp9BSQbUeuq8Qn0RgyxgsTp6dlB6ZxTF4WYO7FSW1rzpCmmb6IenzErIETGVIlIXuSpjdBrqrfi5hHDOkqUCmNMz5BrLxiH45RbyMEb5jSTLdkII9GQshNJQyyLRF1q6QbSqkUQqRKggmIJiESKaQUkMKPZ1HYlHXOzT1Fs3VB2z2Nxh/u8Hu6yf0N9fY/f0J45cPGD+/w/DhBvVqRN3sEK6p6+0PY+H9GkWxQbHu4aoOed/C7wb4toXfD/BjD9+1yNsGeb6C9xuEa47FIjx3INNZC5/nGLoB7aZFkRdo1w26usXYD2g2DXiaTryy5GgsDtUJhQmO8daj8CVc7uF9gaIoUZQlfFGSXp/SJAk7FQLO5tD7NezdDrzIEJ1EiGKGKIofYo7AF4cfSSGQWg1ZOXApSH8PTeKbRE8iDC9RxNH3Ebouhjpv4T/sYa865LdbuLcj2XGuwAkhIw45eMKo66TOgBtFZ2rN5Bg2N2FwijaQroJsC5R/vkR+t4e73SJ/v4MoLeLT+OFx5xWFp5BJCuEMROmojYncTEiFeJ6XI5ZgwwWuYwm9csg/nsG9HVB+uSSU/uOebhDa2UwOA38JjJ64DByGKtOpJL1PZujvP4QRh3MMZ2dLiLpE+cdLuOsB7naEOa8ROP62wjM4vEdoGLjRU2Xv44Ay+QGPxxIv4pgjswkuzpfQQYN3O2QXDaHM3+1QfL6g4UXSWU5oD8l+lJQQCpHAWgauFdKgPzvpMCALzhGFBdcTn+F8FGHg0DqG3W4JfdaQ9tzNiOqvV4QyoA26tG96Qhy+Czc75hxCKGWCPL/n0E48BlTEZUCc6YlL/nRhJoQ2xn57ArVvJv9e3+vw7QD3ZqDPcpV/t1Ecc83UYMPEsxXkytEqosLA70qoukCaG4jKIRHfa/EohzSTbYF01SO7bKjTEFfBy3d7mN2a5nRKvLEZToki8GINefkeXKaTO5Sc+mLokdnEa+BvXoNdnoI3W8i7r1C9R3Y7wt4MsLcj3Mc9suse9v2W5DKnJ1KVaa/hnMZA4QsooeCMpZninYe3Oc2cmSOAgUsOk2Xomg5jN6DyFZq6Qd/2GIYR+/0ZsszSxHsyYcolrjZ3UMqCry3kUEL1FXhhwMsMEWNYnkaP2u27hIJLvGt+R+YKmMsG9qKB2a5pjrjXPbiUSNj8XXGRpAJRHvSWQfclrcWh7YdNNj401cMCOscpjAsw1yDNc5izDbKrFiqIui1ploTlMz6NpvcvogctHhV28HFXv4ApFfRuQ0I2++kMbgnNIdxIDyvYq5b8/dhSv0gFR1nEUKWBOauJu3AGdwRxE9qwhO43yF42JPLHHLMQMkFTx9BeQQ0rWoX1/Rl4DEhFkU2PPueRQ/sv7a/QlYG5aKCHCtllSx0m8Jid14T08N/Ck0VJtIX88g9EUyM7P3DVTRyOqwlhaWc1himhVBDjJdLc0cWqLYizwBct731FQ/8Zuw0DOzmhyk0Sif8Xh6rOWUX+Bd5EKJ50XBx0AAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Project structure\",\n    \"title\": \"Project structure\",\n    \"src\": \"/static/de8e36f96975d09197b874cbdd75d463/9b5be/cdk-express-project-structure.png\",\n    \"srcSet\": [\"/static/de8e36f96975d09197b874cbdd75d463/9b5be/cdk-express-project-structure.png 227w\"],\n    \"sizes\": \"(max-width: 227px) 100vw, 227px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \"))), mdx(\"h2\", null, \"Code refactoring\"), mdx(\"p\", null, \"Now we need to do a little code refactoring so that the function logic can be separated from the Express config.\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"First, open \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"index.ts\"), \" in the project root folder and copy all the codes in function for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/users\"), \" API\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"app.get('/users', (req, res) => {\\n  // COPY start\\n  const users = ['John', 'Tom', 'Mary'].map((name, index) => ({\\n    id: index,\\n    name,\\n  }));\\n  // COPY end\\n  res.json(users);\\n})\\n\\n\")), mdx(\"p\", null, \"create \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"users.ts\"), \" under the project root folder and create the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"getUsers\"), \" function there\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"export const getUsers = () => {\\n}\\n\")), mdx(\"p\", null, \"Now paste the codes that you just copied inside, and add \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"return users;\"), \" at the end to return the result of the function.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"export const getUsers = () => {\\n  const users = ['John', 'Tom', 'Mary'].map((name, index) => ({\\n    id: index,\\n    name,\\n  }));\\n  return users;\\n}\\n\")), mdx(\"p\", null, \"Next, we will create a handler for the Lambda function:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Create \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"handler.ts\"), \" in the project base folder.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Import \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"getUsers\"), \" from \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"users.ts\"), \".\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Add an async function \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"getUsers\"), \" to \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"handler.ts\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Return \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"statusCode\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"body\"), \" in the API response. Make sure that body is a \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"string\"), \".\")), mdx(\"p\", null, \"The returning value determines the API response status code and body.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"import * as users from './users';\\n\\nexport const getUsers = async () => {\\n  const result = users.getUsers();\\n  return {\\n    statusCode: 200,\\n    body: JSON.stringify(result),\\n  };\\n}\\n\")), mdx(\"p\", null, \"The reason to put the actual logic of the function in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"users.ts\"), \" instead of directly putting it in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"handler.ts\"), \" is to make it easier for the original express app to also reuse the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"getUsers\"), \" function in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"users.ts\"), \".\"), mdx(\"p\", null, \"So now we can refactor the original \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"index.ts\"), \" to call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"getUsers\"), \" from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"users.ts\"), \" in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/users\"), \" API.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"import { getUsers } from './users';\\n\\napp.get('/users', (req, res) => {\\n  const users = getUsers();\\n  res.json(users);\\n})\\n\")), mdx(\"h2\", null, \"Add Lambda Function in the stack\"), mdx(\"p\", null, \"Now that the codes are ready, we can work on the CDK stack\"), mdx(\"p\", null, \"Open \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cdk/lib/cdk-stack.ts\"), \" and add the codes to create the Lambda function\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"import * as lambda from '@aws-cdk/aws-lambda';\\n\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"const getUsersHandler = new lambda.Function(this, \\\"GetUsers\\\", {\\n  runtime: lambda.Runtime.NODEJS_14_X,\\n  code: lambda.Code.fromAsset(\\\"../build\\\"), // build output of the handler js\\n  handler: \\\"handler.getUsers\\\" // handler is the handler js file name, getUsers is the function name\\n});\\n\\n\")), mdx(\"p\", null, \"Create the API Gateway Rest API that can trigger the Lambda function\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"import * as apigateway from '@aws-cdk/aws-apigateway';\\n\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"// Create the Rest API\\n    const api = new apigateway.RestApi(this, \\\"UsersApi\\\", {\\n      restApiName: \\\"Users Management\\\",\\n      description: \\\"API for management of users.\\\"\\n    });\\n    // Add the path /users in the API\\n    const apiResource = api.root.addResource(\\\"users\\\");\\n    const getIntegration = new apigateway.LambdaIntegration(getUsersHandler); // linked to the Lambda function here\\n    apiResource.addMethod(\\\"GET\\\", getIntegration);\\n\")), mdx(\"p\", null, \"So at the end, the stack should look like this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"import * as cdk from '@aws-cdk/core';\\nimport * as lambda from '@aws-cdk/aws-lambda';\\nimport * as apigateway from '@aws-cdk/aws-apigateway';\\n\\nexport class CdkStack extends cdk.Stack {\\n  constructor(scope: cdk.Construct, id: string, props?: cdk.StackProps) {\\n    super(scope, id, props);\\n\\n    // The code that defines your stack goes here\\n    const getUsersHandler = new lambda.Function(this, \\\"GetUsers\\\", {\\n      runtime: lambda.Runtime.NODEJS_14_X,\\n      code: lambda.Code.fromAsset(\\\"../build\\\"),\\n      handler: \\\"handler.getUsers\\\"\\n    });\\n\\n    // Create the Rest API\\n    const api = new apigateway.RestApi(this, \\\"UsersApi\\\", {\\n      restApiName: \\\"Users Management\\\",\\n      description: \\\"API for management of users.\\\"\\n    });\\n    // Add the path /users in the API\\n    const apiResource = api.root.addResource(\\\"users\\\");\\n    const getIntegration = new apigateway.LambdaIntegration(getUsersHandler);\\n    apiResource.addMethod(\\\"GET\\\", getIntegration);\\n  }\\n}\\n\")), mdx(\"h2\", null, \"Build the project\"), mdx(\"p\", null, \"Before building the project, we need to exclude \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cdk\"), \" folder in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"tsconfig.json\"), \" in the project base folder.\"), mdx(\"p\", null, \"Since we don't want to build CDK stack on our own (will be handled by CDK deploy)\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-json\"\n  }, \"{\\n  \\\"compilerOptions\\\": {\\n    \\\"target\\\": \\\"es6\\\",\\n    \\\"module\\\": \\\"commonjs\\\",\\n    \\\"rootDir\\\": \\\"./\\\",\\n    \\\"outDir\\\": \\\"./build\\\",\\n    \\\"esModuleInterop\\\": true,\\n    \\\"strict\\\": true,\\n  },\\n  \\\"exclude\\\": [\\\"cdk\\\"]\\n}\\n\")), mdx(\"p\", null, \"Now call \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm run build\"), \" in the shell under the project base folder.\"), mdx(\"p\", null, \"A new folder \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"build\"), \" should be generated at the project base folder, which contains the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"handler.js\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"users.js\"), \" files.\"), mdx(\"h2\", null, \"Deploy the CDK stack\"), mdx(\"p\", null, \"First, go to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cdk\"), \" folder\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"cd cdk\\n\")), mdx(\"p\", null, \"Then, we need to bootstrap the CDK stack, this is for creating the resources required for doing deployment of the CDK stack.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"cdk bootstrap\\n\")), mdx(\"p\", null, \"You can preview the generated Cloudformation template with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cdk synth\"), \" but this is not required to deploy the stack.\"), mdx(\"p\", null, \"Now we can finally deploy our CDK stack to AWS\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"cdk deploy\\n\")), mdx(\"p\", null, \"You should see a screen similar to this:\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./images/cdk-express-deploy.png\"\n  }, mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1200px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"34.66666666666667%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABDklEQVQoz22Q2aocMQxE+/9/Mg8hIWTa7d2y5eWE9twlA1NwKFmGktDx+/qBuf5gHifmPHH2JNaTPiprduZozKHMqYxRN2sOthavWnDkHMkSdoBqQWpEakJaodS8/Ua1fSH17gnalab1PxpHUaGOutP7GIgKMp496Z+1MNf8WsRXx6/8k6sZbLs2Ti2+eY7aKm00xhx7YtXnu/Wbu/7+n3Oy5iLUgKknSSNRA1EjSROpJQ6XHFc2OLHEEjZeHPcgXzyuWIIEVJWufXtrbdddx4d/c7h4B1qiREKJ2GwJJeyQG1fcxksgS95b7vuv9ZbDJ8MV/2LjAxcf+GJI1RHvjeUiiMGXkyAXRctL4Dv9A1AIIa7KX7YSAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"CDK Deploy\",\n    \"title\": \"CDK Deploy\",\n    \"src\": \"/static/b8872bb333e3883c78bfa4304507e792/c1b63/cdk-express-deploy.png\",\n    \"srcSet\": [\"/static/b8872bb333e3883c78bfa4304507e792/5a46d/cdk-express-deploy.png 300w\", \"/static/b8872bb333e3883c78bfa4304507e792/0a47e/cdk-express-deploy.png 600w\", \"/static/b8872bb333e3883c78bfa4304507e792/c1b63/cdk-express-deploy.png 1200w\", \"/static/b8872bb333e3883c78bfa4304507e792/85e74/cdk-express-deploy.png 1436w\"],\n    \"sizes\": \"(max-width: 1200px) 100vw, 1200px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \"))), mdx(\"p\", null, \"input \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"y\"), \" and enter to continue\"), mdx(\"p\", null, \"If the deployment is successful, you should see something similar to this:\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./images/cdk-express-deploy-success.png\"\n  }, mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"755px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"29.333333333333332%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6ElEQVQY052Q7UrDMBhGd/93ok6mTBmC96BDYaJMHWtNavPVTtqka3ukmRR/7I8eOCR5w/MQMlmvXknfP9i8bNBCo4VBbjOybYaRBj0oDLnMkVIihCBN02iSJCil2O12DPR9z2T2eMbi+Yrrp0tmD1POl6dxnd6fMF9dcPt2w2I9Z5ncIRKB0gprLc65aFmWVFUVywYmrjXY/UHXWYpRh2ttnJu9pu4q+u4QOsZYyB/of4LdEcdCUyt8W/2K/J/4h6IoKJoGExpsaFA+UISA8SHus9qT+zA6zD7rgPZNvBvOsvZ87dv4wm/W+cuSQ0f71AAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"CDK Deploy Success\",\n    \"title\": \"CDK Deploy Success\",\n    \"src\": \"/static/e054e000455fb69f63381b159d7563b3/cab43/cdk-express-deploy-success.png\",\n    \"srcSet\": [\"/static/e054e000455fb69f63381b159d7563b3/5a46d/cdk-express-deploy-success.png 300w\", \"/static/e054e000455fb69f63381b159d7563b3/0a47e/cdk-express-deploy-success.png 600w\", \"/static/e054e000455fb69f63381b159d7563b3/cab43/cdk-express-deploy-success.png 755w\"],\n    \"sizes\": \"(max-width: 755px) 100vw, 755px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \"))), mdx(\"p\", null, \"If it deploys successfully, you should be able to see that there's a new stack 'CdkStack' in Cloudformation and the new Rest API created in API Gateway, and the GetUsers Lambda function created in the AWS console.\"), mdx(\"p\", null, \"You can test the deployed API by calling the url displayed in the deployment outputs.\"), mdx(\"p\", null, \"For my case, the url is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"https://ultsb1lqc5.execute-api.ap-southeast-1.amazonaws.com/prod/users\"), \". \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/users\"), \" is the path of the GET API defined in the CDK stack.\"), mdx(\"h2\", null, \"Local test\"), mdx(\"p\", null, \"Since you didn't remove the Express app in the project, you can still run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm start\"), \" in the project for locally testing the API function. Alternatively, you can also test the function by using a testing framework such as \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://jestjs.io/\"\n  }, \"jest\"), \".\"), mdx(\"h2\", null, \"Clean up\"), mdx(\"p\", null, \"Run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cdk destroy\"), \" under the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cdk\"), \" folder to delete the stack or you can delete directly in the AWS Cloutformation console.\"), mdx(\"h2\", null, \"Summary\"), mdx(\"p\", null, \"This blog post is just a glimpse into the power of CDK. Now that you know how it's like to create a Cloudformation Stack with CDK, this opens up the door to the possibilities of defining all kinds of AWS infrastructure with the power of programming languages.\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"7eeba693-6748-56af-90cb-87d2df4c733e","slug":"2021-5-8-turn-express-app-to-lambda-cdk","__params":{"slug":"2021-5-8-turn-express-app-to-lambda-cdk"}}},"staticQueryHashes":["3159585216"]}