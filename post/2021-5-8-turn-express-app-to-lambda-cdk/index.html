<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.11.0"/><meta data-react-helmet="true" charSet="utf-8"/><meta data-react-helmet="true" name="google-site-verification" content="0BOaKw-N8goBTlYnHzJWtb6Yn_4GeZjZHaVxq_RmV3E"/><style data-href="/styles.6ed856706c4e7f2d4814.css" data-identity="gatsby-global-css">a{color:#1976d2}a:hover{color:#004ba0}</style><style data-emotion="css-global 1mskswx">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css 16w95pb 3v8va9 1qsxih2 12o98wt 81nvfi a9n7s9 k6h796 130f8nx hv5q7o 11kqkkz vubbuv 1j414uv 18l9x7f 1wxaqej m136qf 1yxmbwk vooagt 66wxz3 17c40ea eud0j5 d404y7 1nevh8s c6r19y v2arnj 3qcq41">.css-16w95pb{background-color:#e6f1f3;min-height:100vh;}.css-3v8va9{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:0px 3px 5px -1px rgba(0,0,0,0.2),0px 5px 8px 0px rgba(0,0,0,0.14),0px 1px 14px 0px rgba(0,0,0,0.12);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:-webkit-sticky;position:sticky;z-index:1100;top:0;left:auto;right:0;background-color:#456679;color:#fff;}.css-1qsxih2{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-1qsxih2{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.css-1qsxih2{max-width:1200px;}}.css-12o98wt{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;min-height:56px;}@media (min-width:0px){@media (orientation: landscape){.css-12o98wt{min-height:48px;}}}@media (min-width:600px){.css-12o98wt{min-height:64px;}}.css-81nvfi{margin:0;font-family:Merriweather,sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;text-transform:uppercase;color:rgba(0, 0, 0, 0.87);-webkit-text-decoration:none;text-decoration:none;margin-right:8px;}.css-a9n7s9{margin-left:auto;margin-right:auto;}.css-k6h796{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;color:#fff;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}@media (min-width:0px){.css-k6h796{display:none;}}@media (min-width:900px){.css-k6h796{display:block;}}@media (min-width:0px){.css-130f8nx{display:none;}}@media (min-width:600px){.css-130f8nx{display:block;}}.css-hv5q7o{margin:0;font-family:Merriweather,sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;text-transform:uppercase;color:rgba(0, 0, 0, 0.87);-webkit-text-decoration:none;text-decoration:none;margin-left:20px;color:#fff;font-family:roboto;padding:5px 7px;background-color:#51748a;text-align:center;}.css-hv5q7o:hover{color:#fff;background-color:#6a889c;}.css-11kqkkz{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;sx:block;color:#fff;}.css-11kqkkz::-moz-focus-inner{border-style:none;}.css-11kqkkz.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-11kqkkz{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-11kqkkz:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-11kqkkz:hover{background-color:transparent;}}.css-11kqkkz.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}@media (min-width:600px){.css-11kqkkz{display:none;}}.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}.css-1j414uv{position:fixed;right:5px;top:200px;}@media (min-width:0px){.css-1j414uv{display:none;}}@media (min-width:900px){.css-1j414uv{display:block;}}.css-18l9x7f{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;width:100%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin-top:-8px;width:calc(100% + 8px);margin-left:-8px;}.css-18l9x7f>.MuiGrid-item{max-width:none;}.css-18l9x7f>.MuiGrid-item{padding-top:8px;}.css-18l9x7f>.MuiGrid-item{padding-left:8px;}.css-1wxaqej{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}.css-m136qf{margin:0;font-family:inherit;font-weight:inherit;font-size:inherit;line-height:inherit;letter-spacing:inherit;color:#456679;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(69, 102, 121, 0.4);}.css-m136qf:hover{text-decoration-color:inherit;}.css-1yxmbwk{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-1yxmbwk::-moz-focus-inner{border-style:none;}.css-1yxmbwk.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1yxmbwk{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1yxmbwk:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-1yxmbwk:hover{background-color:transparent;}}.css-1yxmbwk.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.css-vooagt{min-height:100vh;}.css-66wxz3{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;padding:40px;}@media (min-width:600px){.css-66wxz3{padding-left:24px;padding-right:24px;}}@media (min-width:900px){.css-66wxz3{max-width:900px;}}.css-17c40ea{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;}@media (min-width:0px){.css-17c40ea{font-size:2rem;}}@media (min-width:900px){.css-17c40ea{font-size:2.5rem;}}.css-eud0j5{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;}.css-d404y7 img{padding:8px;background:#fff;}.css-1nevh8s{background-color:#bedbda;border-top:1px solid #99c5c2;}.css-c6r19y{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;text-align:left;padding-top:16px;padding-bottom:8px;}@media (min-width:600px){.css-c6r19y{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.css-c6r19y{max-width:1200px;}}.css-v2arnj{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;margin-bottom:16px;font-size:12px;}.css-3qcq41{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;margin-bottom:16px;font-size:12px;margin-left:24px;}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc4.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxK.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc4.woff2"/><style>@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:300;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc4.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxK.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc4.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:300;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc-.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxM.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc-.woff) format("woff")}</style><title data-react-helmet="true">Sing Mak&#x27;s software engineering journey | Deploy an AWS Lambda function with AWS CDK</title><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><link href="https://fonts.googleapis.com/css?family=Merriweather|Source+Sans+Pro:300,400,400i,700&amp;display=swap" rel="stylesheet"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="MuiBox-root css-16w95pb"><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation5 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionSticky css-3v8va9"><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><div class="MuiToolbar-root MuiToolbar-regular css-12o98wt"><a class="MuiTypography-root MuiTypography-button MuiLink-root MuiLink-underlineNone css-81nvfi" href="/"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:136px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;30&#x27;%20width=&#x27;136&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear"></div><picture><source type="image/webp" data-srcset="/static/7a681c1580bd25ffd0f41f646f3afa64/ccc63/singmak_logo.webp 34w,/static/7a681c1580bd25ffd0f41f646f3afa64/98ae6/singmak_logo.webp 68w,/static/7a681c1580bd25ffd0f41f646f3afa64/f51e6/singmak_logo.webp 136w" sizes="(min-width: 136px) 136px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 136px) 136px, 100vw" decoding="async" loading="lazy" data-src="/static/7a681c1580bd25ffd0f41f646f3afa64/f72f6/singmak_logo.png" data-srcset="/static/7a681c1580bd25ffd0f41f646f3afa64/7c010/singmak_logo.png 34w,/static/7a681c1580bd25ffd0f41f646f3afa64/f2fee/singmak_logo.png 68w,/static/7a681c1580bd25ffd0f41f646f3afa64/f72f6/singmak_logo.png 136w" alt="SING MAK"/></picture><noscript><picture><source type="image/webp" srcSet="/static/7a681c1580bd25ffd0f41f646f3afa64/ccc63/singmak_logo.webp 34w,/static/7a681c1580bd25ffd0f41f646f3afa64/98ae6/singmak_logo.webp 68w,/static/7a681c1580bd25ffd0f41f646f3afa64/f51e6/singmak_logo.webp 136w" sizes="(min-width: 136px) 136px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 136px) 136px, 100vw" decoding="async" loading="lazy" src="/static/7a681c1580bd25ffd0f41f646f3afa64/f72f6/singmak_logo.png" srcSet="/static/7a681c1580bd25ffd0f41f646f3afa64/7c010/singmak_logo.png 34w,/static/7a681c1580bd25ffd0f41f646f3afa64/f2fee/singmak_logo.png 68w,/static/7a681c1580bd25ffd0f41f646f3afa64/f72f6/singmak_logo.png 136w" alt="SING MAK"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a><div class="MuiBox-root css-a9n7s9"><h1 class="MuiTypography-root MuiTypography-body1 css-k6h796">Deploy an AWS Lambda function with AWS CDK</h1></div><div class="MuiBox-root css-130f8nx"><a class="MuiTypography-root MuiTypography-button MuiLink-root MuiLink-underlineNone css-hv5q7o" href="/">Blog</a><a class="MuiTypography-root MuiTypography-button MuiLink-root MuiLink-underlineNone css-hv5q7o" href="/tags">Tags</a><a class="MuiTypography-root MuiTypography-button MuiLink-root MuiLink-underlineNone css-hv5q7o" href="/about">About</a></div><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium css-11kqkkz" tabindex="0" type="button"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="MenuOutlinedIcon"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button></div></div></header><div class="MuiBox-root css-1j414uv"><div class="MuiGrid-root MuiGrid-container MuiGrid-spacing-xs-1 MuiGrid-direction-xs-column css-18l9x7f"><div class="MuiGrid-root MuiGrid-item css-1wxaqej"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-m136qf" href="https://github.com/singmak"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium css-1yxmbwk" tabindex="0" type="button"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="GitHubIcon"><path d="M12 1.27a11 11 0 00-3.48 21.46c.55.09.73-.28.73-.55v-1.84c-3.03.64-3.67-1.46-3.67-1.46-.55-1.29-1.28-1.65-1.28-1.65-.92-.65.1-.65.1-.65 1.1 0 1.73 1.1 1.73 1.1.92 1.65 2.57 1.2 3.21.92a2 2 0 01.64-1.47c-2.47-.27-5.04-1.19-5.04-5.5 0-1.1.46-2.1 1.2-2.84a3.76 3.76 0 010-2.93s.91-.28 3.11 1.1c1.8-.49 3.7-.49 5.5 0 2.1-1.38 3.02-1.1 3.02-1.1a3.76 3.76 0 010 2.93c.83.74 1.2 1.74 1.2 2.94 0 4.21-2.57 5.13-5.04 5.4.45.37.82.92.82 2.02v3.03c0 .27.1.64.73.55A11 11 0 0012 1.27"></path></svg></button></a></div><div class="MuiGrid-root MuiGrid-item css-1wxaqej"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-m136qf" href="https://www.linkedin.com/in/sing-mak-dev"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium css-1yxmbwk" tabindex="0" type="button"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkedInIcon"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"></path></svg></button></a></div></div></div><div class="MuiBox-root css-vooagt"><div class="MuiContainer-root MuiContainer-maxWidthMd css-66wxz3"><h1 class="MuiTypography-root MuiTypography-body1 css-17c40ea">Deploy an AWS Lambda function with AWS CDK</h1><p class="MuiTypography-root MuiTypography-body1 css-eud0j5">May 8, 2021</p><div class="MuiBox-root css-d404y7"><p>There are many ways to create and configure the infrastructures of our applications on AWS, either it&#x27;s with the console, AWS CLI or AWS Cloudformation. With AWS CDK, we can create AWS Cloudformation stacks with the power of programming languages. AWS CDK supports multiple programming languages. In this blog post, I am going to demonstrate how to turn a simple Express app API written in Typescript into an AWS Lambda function with AWS CDK.</p>
<p>Using AWS Cloudformation is a good way to maintain our infrastructures as code. However, writing a Cloudformation template is not easy. Most of my experience with AWS Cloudformation is with Serverless Framework because when I deploy an AWS Lambda service with Serverless Framework, it deploys the Lambda service as a Cloudformation stack and we don&#x27;t need to write a single line of AWS CloudFormation template. It saves us so much work. What&#x27;s even greater about Serverless Framework is that we can override the generated Cloudformation resources or add additional resources in the stack in the serverless.yml. Outside of Serverless Framework, I mostly just use the AWS console or AWS Cli to manually configure the AWS infrastructure... To be honest I was put off by the huge amount of lines of codes that are required to be written to define a stack in a Cloudformation template and all the template syntax that I need to learn...</p>
<p>But not anymore! Now I know that there&#x27;s a much easier way to create a Cloudformation stack for developers, which is AWS CDK (AWS Cloud Development Kit).</p>
<h2>Prerequisite</h2>
<ul>
<li>AWS CLI environment setup</li>
<li>Node.js version 14+</li>
<li>Knowledge of typescript</li>
<li>Basic knowledge of AWS Lambda</li>
<li>Knowledge of AWS Lambda</li>
</ul>
<h2>Starting point</h2>
<p>First of all, please download the example project from <a href="https://github.com/singmak/cdk-express-example">here</a>.
This tutorial will use the codes in the <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>starting-point</span></code></pre> folder of this repository as a start point.</p>
<h2>Basic CDK stack setup</h2>
<p>Now assume that you have already downloaded the codes of the starting point project.</p>
<p>First of all, we need to install AWS CDK:</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-sh" style="white-space:pre"><span>npm </span><span style="color:#954121">install</span><span> -g aws-cdk
</span><span>cdk </span><span style="color:#408080;font-style:italic">--version</span><span>
</span></code></pre></pre>
<p>Now unzip the downloaded package and go to the <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>starting-point</span></code></pre> folder of the unzipped package in the shell.</p>
<p>Create a CDK folder for separating application codes from the CDK stack codes.</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-sh" style="white-space:pre"><span style="color:#0086b3">mkdir</span><span> cdk
</span><span></span><span style="color:#0086b3">cd</span><span> cdk
</span></code></pre></pre>
<p>Initialize AWS CDK stack with TypeScript template</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-sh" style="white-space:pre"><span>cdk init app </span><span style="color:#408080;font-style:italic">--language typescript</span><span>
</span></code></pre></pre>
<p>Install the dependencies for creating the Lambda function and API Gateway resources in the stack.</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-sh" style="white-space:pre"><span style="color:#0086b3">npm</span><span> i @aws-cdk/aws-apigateway @aws-cdk/aws-lambda
</span></code></pre></pre>
<p>The project should look like this at this point</p>
<a href="./images/cdk-express-project-structure.png"><span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 227px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 219.3832599118943%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAYAAABloJjNAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEw0lEQVR42p1X2XLbRhDkh6QiCcfuYnGfBO9DlBT6kGxZSSpJ2ZXH/P8PdHoWtuJUKiKohyWAFTjqnZnuHk5CpRDbGCa2sIsGpsoQ+AHCUL1qTZTSSG0K2xYoPmxhuwLBFQOqVwYMghASNLYJoq6E7ashGPdeHdCYCAmPnexaxOsW/oWHwCNK/u3sgPIRBAFU3UMlRDgrke57xIsaykZnB/0akF9KCwYskO6mSG9mSLYddGoR+mcG9FnR5yMfpjB1xiNf/VNppZ4LJP/41JoYw3ZhQbI4Q7btkXQ19JWCURG0r4cVGOjQQN49tSZ9v8FstkF/+xHT9RGrT++w+f0jlm+P2Hz+hPXPD9y7x/L9G/TtGr282///mjTNDG07QzPfo+RGc7NFc7dHs+P9m2s+79DsN6jXK9RVD3n/peWKorVBnmUoihyL2QLTukOZF+jrKWZtjyX3Ou4prcdVWRpbCiN5bMuGiDtUde2ubTdFNyWytnXvjWrsKLLI8hx22yJ9t2ILWXiXHjzfh+f5uLry3HV0Hw4IWaUqRzyreDTjmOI4LT16Ri+6gL6vsNl46KcB4sMC5cMG2d0C+bs118rxOxgZdPLtJorIac3VFDBFCpNTLChlImea92MpOBFGmJT5SyvYZY3qlwOKhy3ytysU9xsX/Bw5G3LInCllEJF2EXUxntcOmSxX2TMEYuLxY6EjHIMIdlqi+Lhzuat+PTiUJZ/lHzk5U2OOLPnTCqnhhiFf6xyadhBRuXVKa8hiKO6HwViEnkLdBNjtPZh5i/q3G2THpcufSFjghecqNpWF6JKEViCIigSmTIdK897R7Qw7cAirKsDh4CG+XbqcZRRYyWP5uGfVr5ETsaRhTIM7hNKDaTYg1MyZ9J1OrLMAKZQpWe3IOLQun2MQbrc+4huyhFYqfdh8OSL7ae4YUz6y8m8E/dCfL3nNgNAqigMRJrHzEZMlA0MELY8qaOUqgaRnTyDUqEqfCK/I46XjsVS4/uNuYMv7tcuneI1jzEmmiNFzctBZQZbkboKQFXMskaurOtGGRo+kHrmsK7rddFAW4XL5dI3yEyv8tEd63TuEOh7n0ZOQwqlp8tH2jvkJB15HketD4bHLobXjxSG4vITZHmEf/yQzKuTMYc4cFlLZxy2yeyJndaVtxiHkR0wLsORzlmbIaU4R/SWNU+RlSfPKkSXk90i2UBzoKbFBwUCb1Qa79Q5t3WK9XGMrz7s9WXRDaqbDyHIqoDUJds0Rmp6iG/J3Nox0SlQmjyGjyliDcgGTKMfT8jMSOR6rLLyVysrQ5FhxopH/m0Pmy2cP6jx1yCxdzylN9Z2oqn8PTScCxgjKJc2pJHcXDlWy7hAvGwSXPtnxbQXu+VSlJ9aG6JsL2DJ2Q7swRIIJUtuXSDbT5+dk1zlevxR0YmOFrqXS9IVT6nQ/dcqSk8OSgnTXO+XObucOvdjCS7pIhAzYBYiKGJHkcF49oxNBsHRAUR3/wnez94gjB2jzH54RJl+rKwiTVevyKqLhAo2ZvlROD376i1+qWQzJVe3aRrzZLeZUUx/HzjcTxWE9uv3AgKzy3ZxF6NyvAEGZ3czdvVjA6IAhf1IEFz8iZM+53yfSKt+3C3MXnDF9/Q16oiwIFTLhVwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Project structure"
        title=""
        src="/static/de8e36f96975d09197b874cbdd75d463/9b5be/cdk-express-project-structure.png"
        srcset="/static/de8e36f96975d09197b874cbdd75d463/9b5be/cdk-express-project-structure.png 227w"
        sizes="(max-width: 227px) 100vw, 227px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></span></a>
<h2>Code refactoring</h2>
<p>Now we need to do a little code refactoring so that the function logic can be separated from the Express config.<br/>
<!-- -->First, open <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>index.ts</span></code></pre> in the project root folder and copy all the codes in function for <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>/users</span></code></pre> API</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-typescript" style="white-space:pre"><span>app.get(</span><span style="color:#219161">&#x27;/users&#x27;</span><span>, </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">req, res</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>  </span><span style="color:#408080;font-style:italic">// COPY start</span><span>
</span><span>  </span><span style="color:#954121">const</span><span> users = [</span><span style="color:#219161">&#x27;John&#x27;</span><span>, </span><span style="color:#219161">&#x27;Tom&#x27;</span><span>, </span><span style="color:#219161">&#x27;Mary&#x27;</span><span>].map(</span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">name, index</span><span class="hljs-function">) =&gt;</span><span> ({
</span><span>    </span><span class="hljs-attr">id</span><span>: index,
</span>    name,
<!-- -->  }));
<span>  </span><span style="color:#408080;font-style:italic">// COPY end</span><span>
</span>  res.json(users);
<!-- -->})
<!-- -->
</code></pre></pre>
<p>create <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>users.ts</span></code></pre> under the project root folder and create the <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>getUsers</span></code></pre> function there</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">export</span><span> </span><span style="color:#954121">const</span><span> getUsers = </span><span class="hljs-function">() =&gt;</span><span> {
</span>}
</code></pre></pre>
<p>Now paste the codes that you just copied inside, and add <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span style="color:#954121">return</span><span> users;</span></code></pre> at the end to return the result of the function.</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">export</span><span> </span><span style="color:#954121">const</span><span> getUsers = </span><span class="hljs-function">() =&gt;</span><span> {
</span><span>  </span><span style="color:#954121">const</span><span> users = [</span><span style="color:#219161">&#x27;John&#x27;</span><span>, </span><span style="color:#219161">&#x27;Tom&#x27;</span><span>, </span><span style="color:#219161">&#x27;Mary&#x27;</span><span>].map(</span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">name, index</span><span class="hljs-function">) =&gt;</span><span> ({
</span><span>    </span><span class="hljs-attr">id</span><span>: index,
</span>    name,
<!-- -->  }));
<span>  </span><span style="color:#954121">return</span><span> users;
</span>}
</code></pre></pre>
<p>Next, we will create a handler for the Lambda function:</p>
<ol>
<li>Create <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>handler.ts</span></code></pre> in the project base folder.</li>
<li>Import <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>getUsers</span></code></pre> from <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>users.ts</span></code></pre>.</li>
<li>Add an async function <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>getUsers</span></code></pre> to <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>handler.ts</span></code></pre></li>
<li>Return <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>statusCode</span></code></pre> and <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>body</span></code></pre> in the API response. Make sure that body is a <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>string</span></code></pre>.</li>
</ol>
<p>The returning value determines the API response status code and body.</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">import</span><span> * </span><span style="color:#954121">as</span><span> users </span><span style="color:#954121">from</span><span> </span><span style="color:#219161">&#x27;./users&#x27;</span><span>;
</span>
<span></span><span style="color:#954121">export</span><span> </span><span style="color:#954121">const</span><span> getUsers = </span><span style="color:#954121">async</span><span> () =&gt; {
</span><span>  </span><span style="color:#954121">const</span><span> result = users.getUsers();
</span><span>  </span><span style="color:#954121">return</span><span> {
</span><span>    </span><span class="hljs-attr">statusCode</span><span>: </span><span style="color:#40a070">200</span><span>,
</span><span>    </span><span class="hljs-attr">body</span><span>: </span><span style="color:#0086b3">JSON</span><span>.stringify(result),
</span>  };
<!-- -->}
</code></pre></pre>
<p>The reason to put the actual logic of the function in <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>users.ts</span></code></pre> instead of directly putting it in <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>handler.ts</span></code></pre> is to make it easier for the original express app to also reuse the <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>getUsers</span></code></pre> function in <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>users.ts</span></code></pre>.</p>
<p>So now we can refactor the original <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>index.ts</span></code></pre> to call <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>getUsers</span></code></pre> from <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>users.ts</span></code></pre> in the <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>/users</span></code></pre> API.</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">import</span><span> { getUsers } </span><span style="color:#954121">from</span><span> </span><span style="color:#219161">&#x27;./users&#x27;</span><span>;
</span>
<span>app.get(</span><span style="color:#219161">&#x27;/users&#x27;</span><span>, </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">req, res</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>  </span><span style="color:#954121">const</span><span> users = getUsers();
</span>  res.json(users);
<!-- -->})
</code></pre></pre>
<h2>Add Lambda Function in the stack</h2>
<p>Now that the codes are ready, we can work on the CDK stack</p>
<p>Open <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>cdk/lib/cdk-stack.ts</span></code></pre> and add the codes to create the Lambda function</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">import</span><span> * </span><span style="color:#954121">as</span><span> lambda </span><span style="color:#954121">from</span><span> </span><span style="color:#219161">&#x27;@aws-cdk/aws-lambda&#x27;</span><span>;
</span></code></pre></pre>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">const</span><span> getUsersHandler = </span><span style="color:#954121">new</span><span> lambda.Function(</span><span style="color:#0086b3">this</span><span>, </span><span style="color:#219161">&quot;GetUsers&quot;</span><span>, {
</span><span>  </span><span class="hljs-attr">runtime</span><span>: lambda.Runtime.NODEJS_14_X,
</span><span>  </span><span class="hljs-attr">code</span><span>: lambda.Code.fromAsset(</span><span style="color:#219161">&quot;../build&quot;</span><span>), </span><span style="color:#408080;font-style:italic">// build output of the handler js</span><span>
</span><span>  </span><span class="hljs-attr">handler</span><span>: </span><span style="color:#219161">&quot;handler.getUsers&quot;</span><span> </span><span style="color:#408080;font-style:italic">// handler is the handler js file name, getUsers is the function name</span><span>
</span>});
<!-- -->
</code></pre></pre>
<p>Create the API Gateway Rest API that can trigger the Lambda function</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">import</span><span> * </span><span style="color:#954121">as</span><span> apigateway </span><span style="color:#954121">from</span><span> </span><span style="color:#219161">&#x27;@aws-cdk/aws-apigateway&#x27;</span><span>;
</span></code></pre></pre>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-typescript" style="white-space:pre"><span style="color:#408080;font-style:italic">// Create the Rest API</span><span>
</span><span>    </span><span style="color:#954121">const</span><span> api = </span><span style="color:#954121">new</span><span> apigateway.RestApi(</span><span style="color:#0086b3">this</span><span>, </span><span style="color:#219161">&quot;UsersApi&quot;</span><span>, {
</span><span>      </span><span class="hljs-attr">restApiName</span><span>: </span><span style="color:#219161">&quot;Users Management&quot;</span><span>,
</span><span>      </span><span class="hljs-attr">description</span><span>: </span><span style="color:#219161">&quot;API for management of users.&quot;</span><span>
</span>    });
<span>    </span><span style="color:#408080;font-style:italic">// Add the path /users in the API</span><span>
</span><span>    </span><span style="color:#954121">const</span><span> apiResource = api.root.addResource(</span><span style="color:#219161">&quot;users&quot;</span><span>);
</span><span>    </span><span style="color:#954121">const</span><span> getIntegration = </span><span style="color:#954121">new</span><span> apigateway.LambdaIntegration(getUsersHandler); </span><span style="color:#408080;font-style:italic">// linked to the Lambda function here</span><span>
</span><span>    apiResource.addMethod(</span><span style="color:#219161">&quot;GET&quot;</span><span>, getIntegration);
</span></code></pre></pre>
<p>So at the end, the stack should look like this:</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">import</span><span> * </span><span style="color:#954121">as</span><span> cdk </span><span style="color:#954121">from</span><span> </span><span style="color:#219161">&#x27;@aws-cdk/core&#x27;</span><span>;
</span><span></span><span style="color:#954121">import</span><span> * </span><span style="color:#954121">as</span><span> lambda </span><span style="color:#954121">from</span><span> </span><span style="color:#219161">&#x27;@aws-cdk/aws-lambda&#x27;</span><span>;
</span><span></span><span style="color:#954121">import</span><span> * </span><span style="color:#954121">as</span><span> apigateway </span><span style="color:#954121">from</span><span> </span><span style="color:#219161">&#x27;@aws-cdk/aws-apigateway&#x27;</span><span>;
</span>
<span></span><span style="color:#954121">export</span><span> </span><span class="hljs-class" style="color:#954121">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#458;font-weight:bold">CdkStack</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#954121">extends</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#458;font-weight:bold">cdk</span><span class="hljs-class">.</span><span class="hljs-class" style="color:#458;font-weight:bold">Stack</span><span class="hljs-class"> </span><span>{
</span><span>  </span><span class="hljs-function" style="color:#458;font-weight:bold">constructor</span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">scope: cdk.Construct, id: </span><span class="hljs-function" style="color:#0086b3">string</span><span class="hljs-function" style="color:#00f">, props?: cdk.StackProps</span><span class="hljs-function">)</span><span> {
</span><span>    </span><span style="color:#0086b3">super</span><span>(scope, id, props);
</span>
<span>    </span><span style="color:#408080;font-style:italic">// The code that defines your stack goes here</span><span>
</span><span>    </span><span style="color:#954121">const</span><span> getUsersHandler = </span><span style="color:#954121">new</span><span> lambda.Function(</span><span style="color:#0086b3">this</span><span>, </span><span style="color:#219161">&quot;GetUsers&quot;</span><span>, {
</span><span>      </span><span class="hljs-attr">runtime</span><span>: lambda.Runtime.NODEJS_14_X,
</span><span>      </span><span class="hljs-attr">code</span><span>: lambda.Code.fromAsset(</span><span style="color:#219161">&quot;../build&quot;</span><span>),
</span><span>      </span><span class="hljs-attr">handler</span><span>: </span><span style="color:#219161">&quot;handler.getUsers&quot;</span><span>
</span>    });
<!-- -->
<span>    </span><span style="color:#408080;font-style:italic">// Create the Rest API</span><span>
</span><span>    </span><span style="color:#954121">const</span><span> api = </span><span style="color:#954121">new</span><span> apigateway.RestApi(</span><span style="color:#0086b3">this</span><span>, </span><span style="color:#219161">&quot;UsersApi&quot;</span><span>, {
</span><span>      </span><span class="hljs-attr">restApiName</span><span>: </span><span style="color:#219161">&quot;Users Management&quot;</span><span>,
</span><span>      </span><span class="hljs-attr">description</span><span>: </span><span style="color:#219161">&quot;API for management of users.&quot;</span><span>
</span>    });
<span>    </span><span style="color:#408080;font-style:italic">// Add the path /users in the API</span><span>
</span><span>    </span><span style="color:#954121">const</span><span> apiResource = api.root.addResource(</span><span style="color:#219161">&quot;users&quot;</span><span>);
</span><span>    </span><span style="color:#954121">const</span><span> getIntegration = </span><span style="color:#954121">new</span><span> apigateway.LambdaIntegration(getUsersHandler);
</span><span>    apiResource.addMethod(</span><span style="color:#219161">&quot;GET&quot;</span><span>, getIntegration);
</span>  }
<!-- -->}
</code></pre></pre>
<h2>Build the project</h2>
<p>Before building the project, we need to exclude <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>cdk</span></code></pre> folder in the <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>tsconfig.json</span></code></pre> in the project base folder.</p>
<p>Since we don&#x27;t want to build CDK stack on our own (will be handled by CDK deploy)</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-json" style="white-space:pre"><span>{
</span><span>  </span><span class="hljs-attr">&quot;compilerOptions&quot;</span><span>: {
</span><span>    </span><span class="hljs-attr">&quot;target&quot;</span><span>: </span><span style="color:#219161">&quot;es6&quot;</span><span>,
</span><span>    </span><span class="hljs-attr">&quot;module&quot;</span><span>: </span><span style="color:#219161">&quot;commonjs&quot;</span><span>,
</span><span>    </span><span class="hljs-attr">&quot;rootDir&quot;</span><span>: </span><span style="color:#219161">&quot;./&quot;</span><span>,
</span><span>    </span><span class="hljs-attr">&quot;outDir&quot;</span><span>: </span><span style="color:#219161">&quot;./build&quot;</span><span>,
</span><span>    </span><span class="hljs-attr">&quot;esModuleInterop&quot;</span><span>: </span><span style="color:#954121">true</span><span>,
</span><span>    </span><span class="hljs-attr">&quot;strict&quot;</span><span>: </span><span style="color:#954121">true</span><span>,
</span>  },
<span>  </span><span class="hljs-attr">&quot;exclude&quot;</span><span>: [</span><span style="color:#219161">&quot;cdk&quot;</span><span>]
</span>}
</code></pre></pre>
<p>Now call <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>npm run build</span></code></pre> in the shell under the project base folder.</p>
<p>A new folder <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>build</span></code></pre> should be generated at the project base folder, which contains the <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>handler.js</span></code></pre> and <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>users.js</span></code></pre> files.</p>
<h2>Deploy the CDK stack</h2>
<p>First, go to the <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>cdk</span></code></pre> folder</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-sh" style="white-space:pre"><span style="color:#0086b3">cd</span><span> cdk
</span></code></pre></pre>
<p>Then, we need to bootstrap the CDK stack, this is for creating the resources required for doing deployment of the CDK stack.</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-sh" style="white-space:pre"><span style="color:#000080;font-weight:normal">cdk bootstrap</span><span>
</span></code></pre></pre>
<p>You can preview the generated Cloudformation template with <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>cdk synth</span></code></pre> but this is not required to deploy the stack.</p>
<p>Now we can finally deploy our CDK stack to AWS</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-sh" style="white-space:pre"><span style="color:#000080;font-weight:normal">cdk deploy</span><span>
</span></code></pre></pre>
<p>You should see a screen similar to this:
<a href="./images/cdk-express-deploy.png"><span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 34.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVR42n2RyW4DMQxD5///smgOuYz3TfLCctykRVEkAh5sSzAl2sfdfsDYO8x5wpoT3p3I7UQfDXMqkQfc71zDWgOv4sglotSEMQSqFVUSyWhSUFpG1bLRLugbRW2ssa4qaNr+cFSKNHa+os+O1lngFFduM+s+zzV/pvDicCufMEJXajZOLYJ6HJeqcLoxB6dQPM86FMKJZPzW11pYcyG0AMNnyT0hakQi1z7T2eGSg8knXHWItB9rgK+elhsCV1fZmTlVRddOyx1Cq6OPf1w1CnoKmn0pUNDmb4EnrjjYYtnEIdfMT5l4F0ekgEv83QeRF4vQggTikZojlvj9vpftd4Jf+BcicFC1V3YAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="CDK Deploy"
        title=""
        src="/static/b8872bb333e3883c78bfa4304507e792/c1b63/cdk-express-deploy.png"
        srcset="/static/b8872bb333e3883c78bfa4304507e792/5a46d/cdk-express-deploy.png 300w,
/static/b8872bb333e3883c78bfa4304507e792/0a47e/cdk-express-deploy.png 600w,
/static/b8872bb333e3883c78bfa4304507e792/c1b63/cdk-express-deploy.png 1200w,
/static/b8872bb333e3883c78bfa4304507e792/85e74/cdk-express-deploy.png 1436w"
        sizes="(max-width: 1200px) 100vw, 1200px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></span></a></p>
<p>input <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>y</span></code></pre> and enter to continue</p>
<p>If the deployment is successful, you should see something similar to this:
<a href="./images/cdk-express-deploy-success.png"><span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 755px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 29.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7UlEQVR42q2NUUvDMBSF+///iQ7rqBRU8B/44JiCTLCsTVPbrd1MUm2T9B7TdLL5sicPfJxzcy8nwdPjAlmSIXlLvFd8gzzlYAlDvubYfGxR5qV7r8A5R1EUYIx50jT1c13XMMZgVBAtr3GzmiNeRYheQ1wtLxA+zxC+zFy+xN17jNskxsP6HlnhPiwrCCE8UkoopdC2Lay1U2FH31CDPOCW1OLLMbk62UnYwYKIcE7BQAMI549+RSc+9hL+4gtzySC1gCWL/1DAd3uIrocwFp/aYO/Y9RpKa+cGjcvbTntv+mnX9Me5PuTRByL8AL0wy0QORP65AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="CDK Deploy Success"
        title=""
        src="/static/e054e000455fb69f63381b159d7563b3/cab43/cdk-express-deploy-success.png"
        srcset="/static/e054e000455fb69f63381b159d7563b3/5a46d/cdk-express-deploy-success.png 300w,
/static/e054e000455fb69f63381b159d7563b3/0a47e/cdk-express-deploy-success.png 600w,
/static/e054e000455fb69f63381b159d7563b3/cab43/cdk-express-deploy-success.png 755w"
        sizes="(max-width: 755px) 100vw, 755px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></span></a></p>
<p>If it deploys successfully, you should be able to see that there&#x27;s a new stack &#x27;CdkStack&#x27; in Cloudformation and the new Rest API created in API Gateway, and the GetUsers Lambda function created in the AWS console.</p>
<p>You can test the deployed API by calling the url displayed in the deployment outputs.</p>
<p>For my case, the url is <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>https:</span><span style="color:#408080;font-style:italic">//ultsb1lqc5.execute-api.ap-southeast-1.amazonaws.com/prod/users</span></code></pre>. <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>/users</span></code></pre> is the path of the GET API defined in the CDK stack.</p>
<h2>Local test</h2>
<p>Since you didn&#x27;t remove the Express app in the project, you can still run <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>npm start</span></code></pre> in the project for locally testing the API function. Alternatively, you can also test the function by using a testing framework such as <a href="https://jestjs.io/">jest</a>.</p>
<h2>Clean up</h2>
<p>Run <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>cdk destroy</span></code></pre> under the <pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff;border-left:5px solid #a5d6a7;padding-top:5px;padding-left:16px;padding-right:16px"><code class="language-javascript" style="white-space:pre"><span>cdk</span></code></pre> folder to delete the stack or you can delete directly in the AWS Cloutformation console.</p>
<h2>Summary</h2>
<p>This blog post is just a glimpse into the power of CDK. Now that you know how it&#x27;s like to create a Cloudformation Stack with CDK, this opens up the door to the possibilities of defining all kinds of AWS infrastructure with the power of programming languages.</p></div></div></div><div class="MuiBox-root css-1nevh8s"><div class="MuiContainer-root MuiContainer-maxWidthLg css-c6r19y"><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-v2arnj"> 2022 Sing Mak</p><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-3qcq41">Built with <a href="https://www.gatsbyjs.com" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-m136qf">Gatsby</a> and <a href="https://mui.com" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-m136qf">MUI</a></p></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/post/2021-5-8-turn-express-app-to-lambda-cdk/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-7506eb2d979f6a8c3df8.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-8e778e103c99d8026125.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-1b1533c63317821ad047.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-b0cc8f47ca493c1f60d0.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2021-5-16-sqs-fifo-lambda-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2021-5-16-sqs-fifo-lambda-mdx-0c9f80b43807ece78c2b.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2021-5-30-serverless-manage-resources-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2021-5-30-serverless-manage-resources-mdx-f08de35696c39dbb7cc5.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2021-5-8-turn-express-app-to-lambda-cdk-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2021-5-8-turn-express-app-to-lambda-cdk-mdx-0f9211ac80e2eaca3604.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-12-18-nginx-proxy-server-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-12-18-nginx-proxy-server-mdx-92e67c73c771e094a74e.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-2-13-talking-to-your-database-with-hasura-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-2-13-talking-to-your-database-with-hasura-mdx-844acfc57b7a7d3c047e.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-2-27-lambda-cold-start-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-2-27-lambda-cold-start-mdx-ffb5d983eab31ec71558.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-3-12-blue-green-deployment-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-3-12-blue-green-deployment-mdx-53dfd47481e61f85f45e.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-3-5-database-migration-with-no-downtime-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-3-5-database-migration-with-no-downtime-mdx-187b766562c75d113f3e.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-10-15-planning-vpc-cidr-block-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-10-15-planning-vpc-cidr-block-mdx-158e60287e6dff0225c9.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-10-alive-again-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-10-alive-again-mdx-c77852825766eef810b6.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-11-rancher-desktop-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-11-rancher-desktop-mdx-92f9c6a6d4e5136fc1a6.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-12-identify-the-boundaries-of-microservices-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-12-identify-the-boundaries-of-microservices-mdx-5f9db710943c19085d9c.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-24-learned-a-few-things-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-24-learned-a-few-things-mdx-f438049139292b723114.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-7-2-one-rds-or-multiple-rds-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-7-2-one-rds-or-multiple-rds-mdx-91d8ef389cea6bbbc347.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-7-24-handling-related-data-microservice-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-7-24-handling-related-data-microservice-mdx-b420f50d98dc2db673ee.js\"],\"component---src-pages-tags-tsx\":[\"/component---src-pages-tags-tsx-2226e7404a3904bf5875.js\"],\"component---src-templates-blog-list-tsx\":[\"/component---src-templates-blog-list-tsx-ac979c5f599c2fb3ac22.js\"],\"component---src-templates-tag-tsx\":[\"/component---src-templates-tag-tsx-d905327fdb0bfd51e293.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="3c5e37fe2bdfa377a39b";</script><script src="/webpack-runtime-06bb8d7dba91b53f3318.js" async></script><script src="/framework-59ae4113612e286a204c.js" async></script><script src="/app-7506eb2d979f6a8c3df8.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>