<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta data-react-helmet="true" name="viewport" content="initial-scale=1, width=device-width"/><meta name="generator" content="Gatsby 4.5.4"/><style data-emotion="css-global 1mskswx">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css 1w3sugh 3v8va9 1qsxih2 8p5sgb 1g6cj53 tdyazv 130f8nx nbanr7 ew8j3g vubbuv 66wxz3 1xqtxh1 eud0j5 d404y7 1nevh8s sy1unb">.css-1w3sugh{background-color:#e6f1f3;}.css-3v8va9{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:0px 3px 5px -1px rgba(0,0,0,0.2),0px 5px 8px 0px rgba(0,0,0,0.14),0px 1px 14px 0px rgba(0,0,0,0.12);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:-webkit-sticky;position:sticky;z-index:1100;top:0;left:auto;right:0;background-color:#456679;color:#fff;}.css-1qsxih2{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-1qsxih2{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.css-1qsxih2{max-width:1200px;}}.css-8p5sgb{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;min-height:56px;}@media (min-width:0px) and (orientation: landscape){.css-8p5sgb{min-height:48px;}}@media (min-width:600px){.css-8p5sgb{min-height:64px;}}.css-1g6cj53{margin:0;font-family:Merriweather,sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;text-transform:uppercase;color:rgba(0, 0, 0, 0.87);-webkit-text-decoration:none;text-decoration:none;}.css-tdyazv{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;color:#ede4e9;margin-left:auto;margin-right:auto;font-weight:600;}@media (min-width:0px){.css-130f8nx{display:none;}}@media (min-width:600px){.css-130f8nx{display:block;}}.css-nbanr7{margin:0;font-family:Merriweather,sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;text-transform:uppercase;color:rgba(0, 0, 0, 0.87);-webkit-text-decoration:none;text-decoration:none;margin-left:20px;color:#fff;font-family:roboto;padding:5px 7px;background-color:#51748a;text-align:center;}.css-nbanr7:hover{background-color:#6a889c;}.css-ew8j3g{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;sx:block;}.css-ew8j3g::-moz-focus-inner{border-style:none;}.css-ew8j3g.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-ew8j3g{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-ew8j3g:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-ew8j3g:hover{background-color:transparent;}}.css-ew8j3g.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}@media (min-width:600px){.css-ew8j3g{display:none;}}.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}.css-66wxz3{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;padding:40px;}@media (min-width:600px){.css-66wxz3{padding-left:24px;padding-right:24px;}}@media (min-width:900px){.css-66wxz3{max-width:900px;}}.css-1xqtxh1{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;font-size:3rem;}.css-eud0j5{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;}.css-d404y7 img{padding:8px;background:#fff;}.css-1nevh8s{background-color:#bedbda;border-top:1px solid #99c5c2;}.css-sy1unb{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;text-align:left;padding-top:16px;padding-bottom:8px;font-size:12px;}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true"></title><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBBc4.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxK.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBBc4.woff2"/><style>@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:300;src:url(/static/webfonts/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBBc4.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/webfonts/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxK.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/webfonts/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBBc4.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:300;src:url(/static/webfonts/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBBc-.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/webfonts/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxM.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/webfonts/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBBc-.woff) format("woff")}</style><link href="https://fonts.googleapis.com/css?family=Merriweather|Source+Sans+Pro:300,400,400i,700&amp;display=swap" rel="stylesheet"/><link as="script" rel="preload" href="/webpack-runtime-2ba6b3099658eabbb050.js"/><link as="script" rel="preload" href="/framework-d8189f7cda955829bf48.js"/><link as="script" rel="preload" href="/app-28f558e85b7094055344.js"/><link as="script" rel="preload" href="/73b95f1a9c56e727b331a5e57d94e41ed649d8db-3bab8aef715011c08637.js"/><link as="script" rel="preload" href="/component---src-pages-post-mdx-slug-tsx-5ca0d2d87b61a3e65ee2.js"/><link as="fetch" rel="preload" href="/page-data/post/2021-5-16-sqs-fifo-lambda/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3159585216.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="MuiBox-root css-1w3sugh"><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation5 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionSticky css-3v8va9"><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><div class="MuiToolbar-root MuiToolbar-regular css-8p5sgb"><a class="MuiTypography-root MuiTypography-button MuiLink-root MuiLink-underlineNone css-1g6cj53" href="/"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:136px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;30&#x27; width=&#x27;136&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear"></div><picture><source type="image/webp" data-srcset="/static/7a681c1580bd25ffd0f41f646f3afa64/ccc63/singmak_logo.webp 34w,/static/7a681c1580bd25ffd0f41f646f3afa64/98ae6/singmak_logo.webp 68w,/static/7a681c1580bd25ffd0f41f646f3afa64/f51e6/singmak_logo.webp 136w" sizes="(min-width: 136px) 136px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 136px) 136px, 100vw" decoding="async" loading="lazy" data-src="/static/7a681c1580bd25ffd0f41f646f3afa64/f72f6/singmak_logo.png" data-srcset="/static/7a681c1580bd25ffd0f41f646f3afa64/7c010/singmak_logo.png 34w,/static/7a681c1580bd25ffd0f41f646f3afa64/f2fee/singmak_logo.png 68w,/static/7a681c1580bd25ffd0f41f646f3afa64/f72f6/singmak_logo.png 136w" alt="SING MAK"/></picture><noscript><picture><source type="image/webp" srcSet="/static/7a681c1580bd25ffd0f41f646f3afa64/ccc63/singmak_logo.webp 34w,/static/7a681c1580bd25ffd0f41f646f3afa64/98ae6/singmak_logo.webp 68w,/static/7a681c1580bd25ffd0f41f646f3afa64/f51e6/singmak_logo.webp 136w" sizes="(min-width: 136px) 136px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 136px) 136px, 100vw" decoding="async" loading="lazy" src="/static/7a681c1580bd25ffd0f41f646f3afa64/f72f6/singmak_logo.png" srcSet="/static/7a681c1580bd25ffd0f41f646f3afa64/7c010/singmak_logo.png 34w,/static/7a681c1580bd25ffd0f41f646f3afa64/f2fee/singmak_logo.png 68w,/static/7a681c1580bd25ffd0f41f646f3afa64/f72f6/singmak_logo.png 136w" alt="SING MAK"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div></a><h1 class="MuiTypography-root MuiTypography-body1 css-tdyazv">AWS CDK Example: Process ordered events with AWS Lambda, SQS FIFO and SNS FIFO</h1><div class="MuiBox-root css-130f8nx"><a class="MuiTypography-root MuiTypography-button MuiLink-root MuiLink-underlineNone css-nbanr7" href="/">Blog</a><a class="MuiTypography-root MuiTypography-button MuiLink-root MuiLink-underlineNone css-nbanr7" href="/about">About</a></div><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium css-ew8j3g" tabindex="0" type="button"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="MenuOutlinedIcon"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button></div></div></header><div class="MuiContainer-root MuiContainer-maxWidthMd css-66wxz3"><h1 class="MuiTypography-root MuiTypography-body1 css-1xqtxh1">AWS CDK Example: Process ordered events with AWS Lambda, SQS FIFO and SNS FIFO</h1><p class="MuiTypography-root MuiTypography-body1 css-eud0j5">May 16, 2021</p><div class="MuiBox-root css-d404y7"><p>There are many cases in that services need to react based on the events published by another service. And in some cases, the order of the processing of the messages is important. For example, think about bank transactions, the deposit, transfer, withdrawal events need to be processed in order or there may not be enough money in the bank account to withdraw or transfer the money. In this tutorial, I am going to demonstrate how to implement an infrastructure that can handles events produced by one system and consumed by another system in order with AWS CDK, AWS Lambda, Amazon SQS FIFO queues, and Amazon SNS FIFO.</p><h2>Prerequisite</h2><ul><li>AWS CLI environment <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html">setup</a></li><li>Node.js version 12+</li><li>Basic knowledge of typescript</li><li>Basic knowledge of AWS Lambda</li></ul><h2>Setting up the project</h2><h3>Install AWS CDK</h3><p>If you have not installed AWS CDK, you can install it by:</p><pre><code class="language-sh">npm install aws-cdk
cdk --version
</code></pre><p>If you have installed it already, you should update it to the latest version by</p><pre><code class="language-sh">npm i -g aws-cdk@latest
</code></pre><h3>Init the AWS CDK Project</h3><p>Now create a new folder for your project and initialize it as a Typescript AWS CDK project.</p><pre><code class="language-sh">mkdir my-ordered-message-process-service
cd my-ordered-message-process-service
cdk init app --language typescript
</code></pre><h3>Install dependencies</h3><p>Install the depencies required for creating the stacks. List of available AWS CDK packages can be found <!-- -->[here]<!-- --> (<a href="https://www.npmjs.com/~aws-cdk-team">https://www.npmjs.com/~aws-cdk-team</a>)</p><pre><code class="language-sh">npm i aws-sdk @aws-cdk/aws-sns @aws-cdk/aws-lambda @aws-cdk/aws-apigateway @aws-cdk/aws-sqs \
@aws-cdk/aws-sns-subscriptions @aws-cdk/aws-lambda-event-sources
npm i -D @types/aws-lambda
</code></pre><p>Make sure that all AWS CDK modules are in the same versions or there would be issues in building the project.
If not, you need to update the version in <code>package.json</code> and run <code>npm i</code> again.</p><h3>The stack</h3><p>After the project is initialized by <code>cdk init app</code>, <code>lib/my-ordered-message-process-service-stack.ts</code> should look like this:</p><pre><code class="language-typescript">import * as cdk from &#x27;@aws-cdk/core&#x27;;

export class MyOrderedMessageProcessServiceStack extends cdk.Stack {
  constructor(scope: cdk.Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);
    // The code that defines your stack goes here
  }
}
</code></pre><h3>Update the stack to provision all the resources</h3><p>Now update <code>lib/my-ordered-message-process-service-stack.ts</code> to be like this:</p><pre><code class="language-typescript">import * as cdk from &#x27;@aws-cdk/core&#x27;;
import * as sns from &#x27;@aws-cdk/aws-sns&#x27;;
import * as lambda from &#x27;@aws-cdk/aws-lambda&#x27;;
import * as apigateway from &#x27;@aws-cdk/aws-apigateway&#x27;;
import * as sqs from &#x27;@aws-cdk/aws-sqs&#x27;;
import * as snsSubscriptions from &#x27;@aws-cdk/aws-sns-subscriptions&#x27;;
import * as lambdaEventSources from &#x27;@aws-cdk/aws-lambda-event-sources&#x27;;
import { Duration } from &#x27;@aws-cdk/core&#x27;;
export class MyOrderedMessageProcessServiceStack extends cdk.Stack {
  constructor(scope: cdk.Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const eventMessageTopic = new sns.Topic(this, &#x27;EventMessageTopic&#x27;, {
      topicName: &#x27;eventMessages&#x27;,
      fifo: true,
      contentBasedDeduplication: true,
    });

    // This is optional, you can also publish messages to the SNS topic in any other ways.
    // The Lambda code is set to load from `./lambda/handler.js` (will be generated by `npm run build`)
    // `EVENT_MESSAGE_TOPIC_ARN` is passed into environment variable so that the function can access it
    const publishEventLambda = new lambda.Function(this, &#x27;PublishEventMessage&#x27;, {
      runtime: lambda.Runtime.NODEJS_14_X,
      code: lambda.Code.fromAsset(&quot;./lambda&quot;),
      handler: &quot;handler.publishMessage&quot;,
      environment: {
        EVENT_MESSAGE_TOPIC_ARN: eventMessageTopic.topicArn,
      }
    });

    // grant the lambda permission to publish message to the SNS topic
    eventMessageTopic.grantPublish(publishEventLambda);

    // Create the Rest API
    const api = new apigateway.RestApi(this, &quot;MessageApi&quot;, {
      restApiName: &quot;messageApi&quot;,
      description: &quot;API for publishing messages.&quot;
    });
    // Add the path /users in the API
    const apiResource = api.root.addResource(&quot;messages&quot;);
    const getIntegration = new apigateway.LambdaIntegration(publishEventLambda);
    apiResource.addMethod(&quot;POST&quot;, getIntegration);

    // create SQS FIFO queue
    const processMessageQueue = new sqs.Queue(this, &#x27;ProcessMessage&#x27;, {
      queueName: &#x27;processMessage.fifo&#x27;,
      fifo: true,
    });

    // subscribe to the SNS queue
    eventMessageTopic.addSubscription(new snsSubscriptions.SqsSubscription(processMessageQueue));

    // create the Lambda function and subscribe
    const processEventLambda = new lambda.Function(this, &#x27;ProcessEvent&#x27;, {
      runtime: lambda.Runtime.NODEJS_14_X,
      code: lambda.Code.fromAsset(&quot;./lambda&quot;),
      handler: &quot;handler.processMessage&quot;,
      timeout: Duration.seconds(10), // need to be smaller than the visibilityTimeout of the SQS queue
    });
    processEventLambda.addEventSource(new lambdaEventSources.SqsEventSource(processMessageQueue, {
      batchSize: 2
    }));
  }
}
</code></pre><h3>Create the handlers for the Lambda functions</h3><p>Create a new folder <code>lambda</code> in the project folder and create a new file <code>handler.ts</code>
Put the codes below in <code>./lambda/handler.ts</code></p><pre><code class="language-typescript">import * as AWS from &#x27;aws-sdk&#x27;;
import { APIGatewayEvent, APIGatewayProxyResult, SQSEvent } from &#x27;aws-lambda&#x27;;

// this is passed from the CDK stack
const { EVENT_MESSAGE_TOPIC_ARN } = process.env;

const sns = new AWS.SNS();

export const publishMessage = async (event: APIGatewayEvent): Promise&lt;APIGatewayProxyResult&gt; =&gt; {
  try {
    const { body } = event;
    if (!body) throw new Error(&#x27;no body&#x27;);
    const eventMessages = JSON.parse(body);
    console.log(event);
    for (const eventMessage of eventMessages) {
        const { groupId, message } = eventMessage;
        const response = await sns.publish({
            TopicArn: EVENT_MESSAGE_TOPIC_ARN,
            Message: message,
            MessageGroupId: groupId,
        }).promise();
        console.log(response);
    }
    return {
      statusCode: 200,
      body: eventMessages.length,
    };
  } catch (e) {
    return {
      statusCode: 500,
      body: JSON.stringify(e),
    }
  }
}

export const processMessage = async (event: SQSEvent) =&gt; {
  console.log(&#x27;process message start&#x27;, new Date().toISOString());
  for (const record of event.Records) {
    console.log(`process message... ${record.body}`);
    await new Promise((resolve) =&gt; setTimeout(resolve, 3000)); // similate that it takes 3 secs to process the message
  }
  console.log(&#x27;process message end&#x27;, new Date().toISOString());
};
</code></pre><h2>Build and deploy the stack!!!</h2><p>First you need to build the lambda handler functions</p><pre><code class="language-sh">npm run build
</code></pre><p>Bootstrap the AWS CDK app to provision resources the AWS CDK needs to perform the deployment. For example, AWS CDK may need to have an S3 bucket to store assets that will be used during the deployment of the stack. <a href="https://docs.aws.amazon.com/cdk/latest/guide/bootstrapping.html">Learn more</a></p><pre><code class="language-sh">cdk bootstrap
</code></pre><p>Deploy the AWS CDK app</p><pre><code class="language-sh">cdk deploy
</code></pre><p>The url of the rest API will be displayed in the console output if it&#x27;s deployed successfully</p><h2>Test the deployed stack</h2><p>Since we provisioned a POST API <code>/messages</code> to publishing the messages to the queue, you can use any tools to call the API to test publishing messages
For example, I use <a href="https://marketplace.visualstudio.com/items?itemName=rangav.vscode-thunder-client">Thunder client</a> to make an HTTP request with a JSON body like this
<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:758px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:66.66666666666666%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXElEQVQ4y6WSTU7DMBCFcwlUNY2dxPbE/01SkCoqVe2CDVfgApyDkz9kh1RUpQLaxdN4PNY3b2wX3nsYYxBjxDAMWX3fI3iP9Xqd87mW8lQbxzHv8bpGwyuUXcTi7QMPr+8orLUQQoCIcnTOoVWEuHmCVATqNOqmAeccdQI0zUkprzkHaxWW4wFl2KKYQQkspYTWGooI2gVoY6YGbZv3U2SMZfiZGENdLlCvliiUUnDeI/YD2tSVczRNm2NqoKTMblLjFH8EJpe8BuMcxezOWJtHFVJAimmc+fC8ziNe0XwFRVqkUZSxWO9f4GPAY6RcnN18j9c0NywyTEp01iE8H2C9w+DVGfA3XQClEBNwNwFHnxzy24GkFMg4xN0xP9AY6HaH6VG6jkDGIuyOk8O7gUQg++UweGzuAbZCQHcdlDbw233+Pr1TZwf/BTz9Ic5RrUpUVYWqYhdf5q/AT3epa4zoGIXjAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="test example" title="test example" src="/static/829417419a95540feb683298dee927e0/c8e86/cdk-test-publish-messages.png" srcSet="/static/829417419a95540feb683298dee927e0/5a46d/cdk-test-publish-messages.png 300w,/static/829417419a95540feb683298dee927e0/0a47e/cdk-test-publish-messages.png 600w,/static/829417419a95540feb683298dee927e0/c8e86/cdk-test-publish-messages.png 758w" sizes="(max-width: 758px) 100vw, 758px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p><p>You can check the logs and metrics for SNS and SQS on CloudWatch in the AWS console to check the results of the publishing and processing of the messages. If all works correctly, you should be able to see that the messages are processed one by one in sequences in the correct order from the Cloudwatch logs of the Lambda function that process the messages.
<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:842px">
      <a class="gatsby-resp-image-link" href="/static/c9f3c6f0ec5af2d74a22595c4d14001b/99072/messages-logs.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:60%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABl0lEQVQoz12TWZLDMAhEdf9DJl5lW5b3LYlTxdRDViYzHxQgLNR0Y9MPg7Stl3lZ5DgO2ff98of6aOd5yuv1UiM+z+jPPzWTZbkkSSrWVlJaK23bSl03Ute1lKVVIx+GQZZ1lXEcpes6GYZRz/oe62WaZlnXTQxFEHrfSdO4T+yvc85Av66rIt22TeNvW5ZFJ6NmWu/FOSfOtdJ1/eU78d4rWppP06QoyEE0jpP0FzpQkuMfj4cYmjEuI/ACr83zrE0wYs6ez6ei4BJx9NHIPxzmeSFFUSqXTRP4Y9SyLLVGXlW1PgDiWK84h2trdQL4Nfck0UZ5HsThorVWUWd5Lmma6ahcDA29VFUljXPqo5jQpQ1Zj0jotu06XiD6l3TEYKT/I7Mu7/dbLa6OAcXtdtdXIBYEURCnonjlFwFCHEQADY3j/mHkBo7YNS4jEFyEpt1HffLvtYlTsHuIxgPkTGjgDUFAmGaBL5qwg/BDjYZJmipPiFGU4XtqRVFcPHtdN4MIIOGARiAljo1RHTG+f0O4jNxHi7UfutCOg5d9OBkAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="messages logs" title="messages logs" src="/static/c9f3c6f0ec5af2d74a22595c4d14001b/99072/messages-logs.png" srcSet="/static/c9f3c6f0ec5af2d74a22595c4d14001b/5a46d/messages-logs.png 300w,/static/c9f3c6f0ec5af2d74a22595c4d14001b/0a47e/messages-logs.png 600w,/static/c9f3c6f0ec5af2d74a22595c4d14001b/99072/messages-logs.png 842w" sizes="(max-width: 842px) 100vw, 842px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
  </a>
    </span></p><h2>Source code of this example</h2><p><a href="https://github.com/singmak/my-ordered-message-process-service">https://github.com/singmak/my-ordered-message-process-service</a></p></div></div><div class="MuiBox-root css-1nevh8s"><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><p class="MuiTypography-root MuiTypography-body1 css-sy1unb">© 2022 Sing Mak</p></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/post/2021-5-16-sqs-fifo-lambda/";window.___webpackCompilationHash="8a208deba344984514a3";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-9a282e6bbe6b2b98339c.js"],"app":["/app-28f558e85b7094055344.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-a95993188f5a7562bae7.js"],"component---src-pages-about-tsx":["/component---src-pages-about-tsx-d3e2f23d74761edc35df.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-572c8df4ee49cf3fea25.js"],"component---src-pages-post-mdx-slug-tsx":["/component---src-pages-post-mdx-slug-tsx-5ca0d2d87b61a3e65ee2.js"]};/*]]>*/</script><script src="/polyfill-9a282e6bbe6b2b98339c.js" nomodule=""></script><script src="/component---src-pages-post-mdx-slug-tsx-5ca0d2d87b61a3e65ee2.js" async=""></script><script src="/73b95f1a9c56e727b331a5e57d94e41ed649d8db-3bab8aef715011c08637.js" async=""></script><script src="/app-28f558e85b7094055344.js" async=""></script><script src="/framework-d8189f7cda955829bf48.js" async=""></script><script src="/webpack-runtime-2ba6b3099658eabbb050.js" async=""></script></body></html>