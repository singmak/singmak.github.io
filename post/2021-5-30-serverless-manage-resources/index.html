<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta data-react-helmet="true" name="viewport" content="initial-scale=1, width=device-width"/><meta name="generator" content="Gatsby 4.5.4"/><style data-emotion="css-global 1mskswx">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css 1w3sugh 3v8va9 1c0cfyw 8p5sgb 1g6cj53 tdyazv 130f8nx tm1s61 ew8j3g vubbuv 66wxz3 1xqtxh1 eud0j5 d404y7 1nevh8s sy1unb">.css-1w3sugh{background-color:#e6f1f3;}.css-3v8va9{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:0px 3px 5px -1px rgba(0,0,0,0.2),0px 5px 8px 0px rgba(0,0,0,0.14),0px 1px 14px 0px rgba(0,0,0,0.12);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:-webkit-sticky;position:sticky;z-index:1100;top:0;left:auto;right:0;background-color:#456679;color:#fff;}.css-1c0cfyw{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-1c0cfyw{padding-left:24px;padding-right:24px;}}@media (min-width:900px){.css-1c0cfyw{max-width:900px;}}.css-8p5sgb{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;min-height:56px;}@media (min-width:0px) and (orientation: landscape){.css-8p5sgb{min-height:48px;}}@media (min-width:600px){.css-8p5sgb{min-height:64px;}}.css-1g6cj53{margin:0;font-family:Merriweather,sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;text-transform:uppercase;color:rgba(0, 0, 0, 0.87);-webkit-text-decoration:none;text-decoration:none;}.css-tdyazv{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;color:#ede4e9;margin-left:auto;margin-right:auto;font-weight:600;}@media (min-width:0px){.css-130f8nx{display:none;}}@media (min-width:600px){.css-130f8nx{display:block;}}.css-tm1s61{margin:0;font-family:Merriweather,sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;text-transform:uppercase;color:rgba(0, 0, 0, 0.87);-webkit-text-decoration:none;text-decoration:none;margin-left:20px;color:#fff;font-family:roboto;padding:5px 7px;background-color:#51748a;text-align:center;}.css-tm1s61:hover{background-color:#6a889c;}.css-ew8j3g{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;sx:block;}.css-ew8j3g::-moz-focus-inner{border-style:none;}.css-ew8j3g.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-ew8j3g{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-ew8j3g:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-ew8j3g:hover{background-color:transparent;}}.css-ew8j3g.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}@media (min-width:600px){.css-ew8j3g{display:none;}}.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}.css-66wxz3{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;padding:40px;}@media (min-width:600px){.css-66wxz3{padding-left:24px;padding-right:24px;}}@media (min-width:900px){.css-66wxz3{max-width:900px;}}.css-1xqtxh1{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;font-size:3rem;}.css-eud0j5{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;}.css-d404y7 img{padding:8px;background:#fff;}.css-1nevh8s{background-color:#bedbda;border-top:1px solid #99c5c2;}.css-sy1unb{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;text-align:left;padding-top:16px;padding-bottom:8px;font-size:12px;}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true"></title><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBBc4.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxK.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBBc4.woff2"/><style>@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:300;src:url(/static/webfonts/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBBc4.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/webfonts/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxK.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/webfonts/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBBc4.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:300;src:url(/static/webfonts/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBBc-.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/webfonts/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxM.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/webfonts/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBBc-.woff) format("woff")}</style><link href="https://fonts.googleapis.com/css?family=Merriweather|Source+Sans+Pro:300,400,400i,700&amp;display=swap" rel="stylesheet"/><link as="script" rel="preload" href="/webpack-runtime-0912c6568e5ebb3773f6.js"/><link as="script" rel="preload" href="/framework-d8189f7cda955829bf48.js"/><link as="script" rel="preload" href="/app-8b866baaf550b7db146f.js"/><link as="script" rel="preload" href="/7fdc34ca3d837c026f97cc8696d9eeac979076fa-971975186888962ccdfa.js"/><link as="script" rel="preload" href="/component---src-pages-post-mdx-slug-tsx-5ca0d2d87b61a3e65ee2.js"/><link as="fetch" rel="preload" href="/page-data/post/2021-5-30-serverless-manage-resources/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3159585216.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="MuiBox-root css-1w3sugh"><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation5 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionSticky css-3v8va9"><div class="MuiContainer-root MuiContainer-maxWidthMd css-1c0cfyw"><div class="MuiToolbar-root MuiToolbar-regular css-8p5sgb"><a class="MuiTypography-root MuiTypography-button MuiLink-root MuiLink-underlineNone css-1g6cj53" href="/"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:130px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;19&#x27; width=&#x27;130&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear"></div><picture><source type="image/webp" data-srcset="/static/16be305db0f3cd76829757d697359497/54ac8/singmak_logo.webp 33w,/static/16be305db0f3cd76829757d697359497/1189d/singmak_logo.webp 65w,/static/16be305db0f3cd76829757d697359497/3f44f/singmak_logo.webp 130w" sizes="(min-width: 130px) 130px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 130px) 130px, 100vw" decoding="async" loading="lazy" data-src="/static/16be305db0f3cd76829757d697359497/0150a/singmak_logo.png" data-srcset="/static/16be305db0f3cd76829757d697359497/fdad8/singmak_logo.png 33w,/static/16be305db0f3cd76829757d697359497/b009a/singmak_logo.png 65w,/static/16be305db0f3cd76829757d697359497/0150a/singmak_logo.png 130w" alt="SING MAK"/></picture><noscript><picture><source type="image/webp" srcSet="/static/16be305db0f3cd76829757d697359497/54ac8/singmak_logo.webp 33w,/static/16be305db0f3cd76829757d697359497/1189d/singmak_logo.webp 65w,/static/16be305db0f3cd76829757d697359497/3f44f/singmak_logo.webp 130w" sizes="(min-width: 130px) 130px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 130px) 130px, 100vw" decoding="async" loading="lazy" src="/static/16be305db0f3cd76829757d697359497/0150a/singmak_logo.png" srcSet="/static/16be305db0f3cd76829757d697359497/fdad8/singmak_logo.png 33w,/static/16be305db0f3cd76829757d697359497/b009a/singmak_logo.png 65w,/static/16be305db0f3cd76829757d697359497/0150a/singmak_logo.png 130w" alt="SING MAK"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div></a><h1 class="MuiTypography-root MuiTypography-body1 css-tdyazv">Managing CloudFormation stack with Serverless Framework</h1><div class="MuiBox-root css-130f8nx"><a class="MuiTypography-root MuiTypography-button MuiLink-root MuiLink-underlineNone css-tm1s61" href="/">Blog</a></div><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium css-ew8j3g" tabindex="0" type="button"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="MenuOutlinedIcon"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button></div></div></header><div class="MuiContainer-root MuiContainer-maxWidthMd css-66wxz3"><h1 class="MuiTypography-root MuiTypography-body1 css-1xqtxh1">Managing CloudFormation stack with Serverless Framework</h1><p class="MuiTypography-root MuiTypography-body1 css-eud0j5">May 30, 2021</p><div class="MuiBox-root css-d404y7"><p>It&#x27;s easy to create a AWS Lambda service with Serverless Framework. We just need to write the serverless.yml and Serverless Framework can use the serverless.yml properties to generate the infrastructure resources that the AWS Lambda functions depend on. Basically, if the provider in the serverless.yml is <code>aws</code>, the Serverless Framework Service is a Cloudformation stack. Serverless Framework support Cloudformation syntax in serverless.yml. You can add new resources and override / modify the resources generated by Serverless in serverless.yml.</p><h2>Adding new resources</h2><p>It&#x27;s straightforward to add new resources. You just need to add the resources under the resources -&gt; Resources sections. The resources can be defined in CloudFormation template syntax.
You can add any resources that your Lambda functions needs in this section. It can be a DynamoDb table, an S3 bucket.</p><pre><code class="language-yml">resources:
  Resources:
    usersTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: usersTable
        AttributeDefinitions:
          - AttributeName: email
            AttributeType: S
        KeySchema:
          - AttributeName: email
            KeyType: HASH
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
</code></pre><h2>The Serverless Framework generated resources</h2><p>There are many cases that we need to reference the Serverless Framework generated resources in provisioning addition resources. All the resource names are generated based on name templates documented in the <code>The Serverless Framework generated resources</code> in <a href="https://www.serverless.com/framework/docs/providers/aws/guide/resources/">https://www.serverless.com/framework/docs/providers/aws/guide/resources/</a>
One example copied from the documentation:</p><pre><code>When you override basic resources, there are two things to keep in mind when it comes to normalizedFunctionName:

It should start with an uppercase character
The - will be changed to Dash, _ will be changed to Underscore
</code></pre><p>so the <code>normalizedFunctionName</code> of a function named <code>write-port</code> in the serverless.yml will be <code>WriteDashPost</code>.</p><h2>Depending on the Serverless Framework generated resources</h2><p>We can create resources that depend on the resources that are generated by Serverless Framework.</p><p>For example here we are adding a Gateway Response resource to the generated Rest Api <code>ApiGatewayRestApi</code></p><pre><code class="language-yml">GatewayResponseDefault4XX:
  Type: &#x27;AWS::ApiGateway::GatewayResponse&#x27;
  Properties:
    ResponseParameters:
      gatewayresponse.header.Access-Control-Allow-Origin: &quot;&#x27;*&#x27;&quot;
      gatewayresponse.header.Access-Control-Allow-Headers: &quot;&#x27;*&#x27;&quot;
    ResponseType: DEFAULT_4XX
    RestApiId:
      Ref: &#x27;ApiGatewayRestApi&#x27;
</code></pre><p>Another example, adding an API mapping to the generated <code>ApiGatewayDeployment${sls:instanceId}</code> resource.</p><p><code>DependsOn</code> is used since this resource can only be created after <code>ApiGatewayDeployment${sls:instanceId}</code> being created.</p><pre><code class="language-yml">UserApiMapping:
  Type: AWS::ApiGatewayV2::ApiMapping
  DependsOn: ApiGatewayDeployment${sls:instanceId}
  Properties: 
    ApiId:
      Ref: ApiGatewayRestApi
    ApiMappingKey: users
    DomainName: api-${self:provider.stage}.sing-example.com
    Stage: ${self:provider.stage}
</code></pre><h2>Override Serverless Framework resources</h2><p>Serverless Framwork has a <a href="https://www.serverless.com/framework/docs/providers/aws/guide/resources/#override-aws-cloudformation-resource">detailed documentation</a> about how to override Serverless Framework generated resources.</p></div></div><div class="MuiBox-root css-1nevh8s"><div class="MuiContainer-root MuiContainer-maxWidthMd css-1c0cfyw"><p class="MuiTypography-root MuiTypography-body1 css-sy1unb">© 2022 Sing Mak</p></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/post/2021-5-30-serverless-manage-resources/";window.___webpackCompilationHash="6623f6d1ab5ffeebb494";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-9a282e6bbe6b2b98339c.js"],"app":["/app-8b866baaf550b7db146f.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-a95993188f5a7562bae7.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-572c8df4ee49cf3fea25.js"],"component---src-pages-post-mdx-slug-tsx":["/component---src-pages-post-mdx-slug-tsx-5ca0d2d87b61a3e65ee2.js"]};/*]]>*/</script><script src="/polyfill-9a282e6bbe6b2b98339c.js" nomodule=""></script><script src="/component---src-pages-post-mdx-slug-tsx-5ca0d2d87b61a3e65ee2.js" async=""></script><script src="/7fdc34ca3d837c026f97cc8696d9eeac979076fa-971975186888962ccdfa.js" async=""></script><script src="/app-8b866baaf550b7db146f.js" async=""></script><script src="/framework-d8189f7cda955829bf48.js" async=""></script><script src="/webpack-runtime-0912c6568e5ebb3773f6.js" async=""></script></body></html>