<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.11.0"/><meta data-react-helmet="true" charSet="utf-8"/><meta data-react-helmet="true" name="google-site-verification" content="0BOaKw-N8goBTlYnHzJWtb6Yn_4GeZjZHaVxq_RmV3E"/><style data-href="/styles.6ed856706c4e7f2d4814.css" data-identity="gatsby-global-css">a{color:#1976d2}a:hover{color:#004ba0}</style><style data-emotion="css-global 1mskswx">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css 16w95pb 3v8va9 1qsxih2 12o98wt 81nvfi a9n7s9 k6h796 130f8nx hv5q7o 11kqkkz vubbuv 1j414uv 18l9x7f 1wxaqej m136qf 1yxmbwk vooagt 66wxz3 17c40ea eud0j5 d404y7 1nevh8s c6r19y v2arnj 3qcq41">.css-16w95pb{background-color:#e6f1f3;min-height:100vh;}.css-3v8va9{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:0px 3px 5px -1px rgba(0,0,0,0.2),0px 5px 8px 0px rgba(0,0,0,0.14),0px 1px 14px 0px rgba(0,0,0,0.12);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:-webkit-sticky;position:sticky;z-index:1100;top:0;left:auto;right:0;background-color:#456679;color:#fff;}.css-1qsxih2{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-1qsxih2{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.css-1qsxih2{max-width:1200px;}}.css-12o98wt{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;min-height:56px;}@media (min-width:0px){@media (orientation: landscape){.css-12o98wt{min-height:48px;}}}@media (min-width:600px){.css-12o98wt{min-height:64px;}}.css-81nvfi{margin:0;font-family:Merriweather,sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;text-transform:uppercase;color:rgba(0, 0, 0, 0.87);-webkit-text-decoration:none;text-decoration:none;margin-right:8px;}.css-a9n7s9{margin-left:auto;margin-right:auto;}.css-k6h796{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;color:#fff;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}@media (min-width:0px){.css-k6h796{display:none;}}@media (min-width:900px){.css-k6h796{display:block;}}@media (min-width:0px){.css-130f8nx{display:none;}}@media (min-width:600px){.css-130f8nx{display:block;}}.css-hv5q7o{margin:0;font-family:Merriweather,sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;text-transform:uppercase;color:rgba(0, 0, 0, 0.87);-webkit-text-decoration:none;text-decoration:none;margin-left:20px;color:#fff;font-family:roboto;padding:5px 7px;background-color:#51748a;text-align:center;}.css-hv5q7o:hover{color:#fff;background-color:#6a889c;}.css-11kqkkz{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;sx:block;color:#fff;}.css-11kqkkz::-moz-focus-inner{border-style:none;}.css-11kqkkz.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-11kqkkz{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-11kqkkz:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-11kqkkz:hover{background-color:transparent;}}.css-11kqkkz.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}@media (min-width:600px){.css-11kqkkz{display:none;}}.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}.css-1j414uv{position:fixed;right:5px;top:200px;}@media (min-width:0px){.css-1j414uv{display:none;}}@media (min-width:900px){.css-1j414uv{display:block;}}.css-18l9x7f{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;width:100%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin-top:-8px;width:calc(100% + 8px);margin-left:-8px;}.css-18l9x7f>.MuiGrid-item{max-width:none;}.css-18l9x7f>.MuiGrid-item{padding-top:8px;}.css-18l9x7f>.MuiGrid-item{padding-left:8px;}.css-1wxaqej{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}.css-m136qf{margin:0;font-family:inherit;font-weight:inherit;font-size:inherit;line-height:inherit;letter-spacing:inherit;color:#456679;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(69, 102, 121, 0.4);}.css-m136qf:hover{text-decoration-color:inherit;}.css-1yxmbwk{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-1yxmbwk::-moz-focus-inner{border-style:none;}.css-1yxmbwk.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1yxmbwk{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1yxmbwk:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-1yxmbwk:hover{background-color:transparent;}}.css-1yxmbwk.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.css-vooagt{min-height:100vh;}.css-66wxz3{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;padding:40px;}@media (min-width:600px){.css-66wxz3{padding-left:24px;padding-right:24px;}}@media (min-width:900px){.css-66wxz3{max-width:900px;}}.css-17c40ea{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;}@media (min-width:0px){.css-17c40ea{font-size:2rem;}}@media (min-width:900px){.css-17c40ea{font-size:2.5rem;}}.css-eud0j5{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;}.css-d404y7 img{padding:8px;background:#fff;}.css-1nevh8s{background-color:#bedbda;border-top:1px solid #99c5c2;}.css-c6r19y{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;text-align:left;padding-top:16px;padding-bottom:8px;}@media (min-width:600px){.css-c6r19y{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.css-c6r19y{max-width:1200px;}}.css-v2arnj{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;margin-bottom:16px;font-size:12px;}.css-3qcq41{margin:0;font-family:Merriweather,sans-serif;font-weight:400;font-size:1rem;line-height:1.5;margin-bottom:16px;font-size:12px;margin-left:24px;}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc4.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxK.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc4.woff2"/><style>@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:300;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc4.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxK.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc4.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:300;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc-.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxM.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc-.woff) format("woff")}</style><title data-react-helmet="true">Sing Mak&#x27;s software engineering journey | Finding out the cold start time of a AWS Lambda function</title><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><link href="https://fonts.googleapis.com/css?family=Merriweather|Source+Sans+Pro:300,400,400i,700&amp;display=swap" rel="stylesheet"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="MuiBox-root css-16w95pb"><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation5 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionSticky css-3v8va9"><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><div class="MuiToolbar-root MuiToolbar-regular css-12o98wt"><a class="MuiTypography-root MuiTypography-button MuiLink-root MuiLink-underlineNone css-81nvfi" href="/"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained"><div style="max-width:136px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;30&#x27;%20width=&#x27;136&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear"></div><picture><source type="image/webp" data-srcset="/static/7a681c1580bd25ffd0f41f646f3afa64/ccc63/singmak_logo.webp 34w,/static/7a681c1580bd25ffd0f41f646f3afa64/98ae6/singmak_logo.webp 68w,/static/7a681c1580bd25ffd0f41f646f3afa64/f51e6/singmak_logo.webp 136w" sizes="(min-width: 136px) 136px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 136px) 136px, 100vw" decoding="async" loading="lazy" data-src="/static/7a681c1580bd25ffd0f41f646f3afa64/f72f6/singmak_logo.png" data-srcset="/static/7a681c1580bd25ffd0f41f646f3afa64/7c010/singmak_logo.png 34w,/static/7a681c1580bd25ffd0f41f646f3afa64/f2fee/singmak_logo.png 68w,/static/7a681c1580bd25ffd0f41f646f3afa64/f72f6/singmak_logo.png 136w" alt="SING MAK"/></picture><noscript><picture><source type="image/webp" srcSet="/static/7a681c1580bd25ffd0f41f646f3afa64/ccc63/singmak_logo.webp 34w,/static/7a681c1580bd25ffd0f41f646f3afa64/98ae6/singmak_logo.webp 68w,/static/7a681c1580bd25ffd0f41f646f3afa64/f51e6/singmak_logo.webp 136w" sizes="(min-width: 136px) 136px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 136px) 136px, 100vw" decoding="async" loading="lazy" src="/static/7a681c1580bd25ffd0f41f646f3afa64/f72f6/singmak_logo.png" srcSet="/static/7a681c1580bd25ffd0f41f646f3afa64/7c010/singmak_logo.png 34w,/static/7a681c1580bd25ffd0f41f646f3afa64/f2fee/singmak_logo.png 68w,/static/7a681c1580bd25ffd0f41f646f3afa64/f72f6/singmak_logo.png 136w" alt="SING MAK"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a><div class="MuiBox-root css-a9n7s9"><h1 class="MuiTypography-root MuiTypography-body1 css-k6h796">The road to Zero Downtime: Migration of data and database schema changes</h1></div><div class="MuiBox-root css-130f8nx"><a class="MuiTypography-root MuiTypography-button MuiLink-root MuiLink-underlineNone css-hv5q7o" href="/">Blog</a><a class="MuiTypography-root MuiTypography-button MuiLink-root MuiLink-underlineNone css-hv5q7o" href="/tags">Tags</a><a class="MuiTypography-root MuiTypography-button MuiLink-root MuiLink-underlineNone css-hv5q7o" href="/about">About</a></div><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium css-11kqkkz" tabindex="0" type="button"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="MenuOutlinedIcon"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button></div></div></header><div class="MuiBox-root css-1j414uv"><div class="MuiGrid-root MuiGrid-container MuiGrid-spacing-xs-1 MuiGrid-direction-xs-column css-18l9x7f"><div class="MuiGrid-root MuiGrid-item css-1wxaqej"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-m136qf" href="https://github.com/singmak"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium css-1yxmbwk" tabindex="0" type="button"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="GitHubIcon"><path d="M12 1.27a11 11 0 00-3.48 21.46c.55.09.73-.28.73-.55v-1.84c-3.03.64-3.67-1.46-3.67-1.46-.55-1.29-1.28-1.65-1.28-1.65-.92-.65.1-.65.1-.65 1.1 0 1.73 1.1 1.73 1.1.92 1.65 2.57 1.2 3.21.92a2 2 0 01.64-1.47c-2.47-.27-5.04-1.19-5.04-5.5 0-1.1.46-2.1 1.2-2.84a3.76 3.76 0 010-2.93s.91-.28 3.11 1.1c1.8-.49 3.7-.49 5.5 0 2.1-1.38 3.02-1.1 3.02-1.1a3.76 3.76 0 010 2.93c.83.74 1.2 1.74 1.2 2.94 0 4.21-2.57 5.13-5.04 5.4.45.37.82.92.82 2.02v3.03c0 .27.1.64.73.55A11 11 0 0012 1.27"></path></svg></button></a></div><div class="MuiGrid-root MuiGrid-item css-1wxaqej"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-m136qf" href="https://www.linkedin.com/in/sing-mak-dev"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium css-1yxmbwk" tabindex="0" type="button"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkedInIcon"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"></path></svg></button></a></div></div></div><div class="MuiBox-root css-vooagt"><div class="MuiContainer-root MuiContainer-maxWidthMd css-66wxz3"><h1 class="MuiTypography-root MuiTypography-body1 css-17c40ea">The road to Zero Downtime: Migration of data and database schema changes</h1><p class="MuiTypography-root MuiTypography-body1 css-eud0j5">March 5, 2022</p><div class="MuiBox-root css-d404y7"><div></div><p>Recently, our team is discussing if it&#x27;s possible to deploy changes to production without downtime. Some of the difficult tasks to do when the server is up and running are:</p>
<ul>
<li>Applying database schema changes</li>
<li>Data migration</li>
</ul>
<p>While it may sound risky to make changes to database schema or do data migration when the clients are still making requests and producing new data transactions it&#x27;s not impossible to handle these tasks without bringing down the service. In this post, I am going to discuss how we can achieve no downtime in our service even when we need to apply new data schema changes and perform data migration.</p>
<h2>Schema changes</h2>
<p>To achieve no downtime, we should deploy database schema changes before deploying the new version of the API service. The reason is that if we deploy the new version of the API service first, the APIs that require the new database schema changes will be broken since the new database schema changes are not there yet.</p>
<p>Therefore, the new version of the database schema should be deployed first and it must be compatible with the existing version of the API in the production environment when the new API version is still not deployed, which means we cannot simply remove or rename any existing tables and columns or change the column data types. We can only do those changes (delete or alter tables, columns, etc) only when we are sure that the tables or the table columns are not referenced anywhere anymore in the API service.</p>
<h2>Data migration</h2>
<p>Data migration may be required for different reasons such as infrastructure changes or business logic changes. It can be tricky to achieve no downtime in doing data migration since new data can still be created during the data migration. Therefore, during data migration, we need to handle it at the API codes level so that the new data are also automatically migrated.</p>
<p>For example, assume that there is an existing API service, which contains APIs that perform CRUD in a database table A. There is also a web application that makes requests to the API service.</p>
<p>We need to implement a new business flow and it will replace the existing flow. This new business flow requires the data to be structured differently so a new table B is created to meet the requirement of the new data model. A data migration script is written to transform the data in table A into the new structure and store the transformed data in the new Table B. Both the API service and the web application also need to be updated to implement the new business flow.</p>
<p>How to implement the API in the API services and perform the deployment in such a way that we can achieve no downtime?</p>
<p>First of all, even if we have deployed a new version of the web application, we cannot be sure that all client browsers will be loading the latest version of the web application since we cannot know when the users&#x27; browsers will load the latest version of the web application. So for a short amount of time, there will be some users who are still interacting with the old version of the web application. Therefore, in addition to adding new APIs for the new business flow, the existing API that is being used to write data to Table A also need to be updated to be able to transform the data and write to the new Table B. Doing it this way, we will only need to run the data migration script once to migrate the existing data.</p>
<p>After the new version of the API service is deployed, we can run the migration script to migrate the data from Table A to Table B with the new data structure. During this time, the web application is still not updated and it is still making requests to the old API. But since the old API has been updated to also transform and write data to Table B, we don&#x27;t need to worry about missing some data in the new Table B.</p>
<p>After the data migration script finishes migrating the data, we can safely deploy the latest version of the web application, that is updated for the new business flow, and makes requests to the new API.</p>
<p>In summary, to achieve no downtime for data migration, I think the deployment order should be like this:</p>
<ol>
<li>Apply data schema changes to production database (make sure it&#x27;s backward compatible with current API service)</li>
<li>Deploy API service (make sure it&#x27;s backward compatible with current web application and also automatically handle data migration for new data)</li>
<li>Run data migration script to migrate existing data</li>
<li>Deploy the web application</li>
</ol>
<p>After running with the new updated version of the API service for some time and when all users are using the new version of the web application, the old APIs and the old Table A will eventually become obsolete and we can remove them in the next release of the API service.</p>
<span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 559px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/55c07cee1c308c9cbfaeec488924bd8e/a65ce/data-migration.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 68%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACC0lEQVR42m2UWU/bUBBG/f9/Rl/ah/alVVUhBYlCoQIESgIhFCVs2RPHjpfsy8c9097IrXqlkefaM2fWJNB/TpZlStNUeZ5rOp2aJEmiyWSyt9lsNtput/YsShCOI1Vv66rc3KnXH5gxsDiODRJFkYEIwrvdbmegfwMiYRgquCrfqFb/pVa7q5OzCwN2ul2NRiOTVqulfr9vAO5A5vO5xuOx6QRF0A1Yu3/Ql28lffj0Wcdn5w63s6x8hkTGGBhZLhYLg7fbbXs/GAxMsMMmeHlt6/K6qq8Hhyq7sufOAePhcGhZdDodyxAYjkDW67VBgdMOEkDHPkizXEg+nSlJM2X5VLPZzADL5dLK48k7PxSAZMRZrVb2jcP3wE+NZiMcolEu/SPTXq9nLfCODMXrwAm6B3qIh3IwIANKodGUDBCHYrZk54e0B+bO8fH5VU9OkiS1D34dcPDrQcZAyQ4oLSEBqvkLWLm9U8XtYePxWT8vr3+vjRsE2QGhXHScuPuS/XAA8x2dgEG1dq/S0Q8dlL7r+PRcSxexuMw+Q+7ofhBMnCD02E/Z1qb59KLDo1O9e/9RF1dlrZ3x8M9Sswb0D51e4kj/AHfd8gPkPXboBhyFkcZRrCieaDAMFU8SM8LJ/5zQcQBI/4o/PQIgfvmD4p+CnzLl1Ouur42Gms2mPbmzRt7O7yelIugk8AaSUilhvc7w5wAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="data-migration"
        title=""
        src="/static/55c07cee1c308c9cbfaeec488924bd8e/a65ce/data-migration.png"
        srcset="/static/55c07cee1c308c9cbfaeec488924bd8e/5a46d/data-migration.png 300w,
/static/55c07cee1c308c9cbfaeec488924bd8e/a65ce/data-migration.png 559w"
        sizes="(max-width: 559px) 100vw, 559px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></span></div></div></div><div class="MuiBox-root css-1nevh8s"><div class="MuiContainer-root MuiContainer-maxWidthLg css-c6r19y"><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-v2arnj">© 2022 Sing Mak</p><p class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph css-3qcq41">Built with <a href="https://www.gatsbyjs.com" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-m136qf">Gatsby</a> and <a href="https://mui.com" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-m136qf">MUI</a></p></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/post/2022-3-5-database-migration-with-no-downtime/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-889712e9418faa6c5175.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-8e778e103c99d8026125.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-a6e607bd291d15711805.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-7868d7601d2283869635.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2021-5-16-sqs-fifo-lambda-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2021-5-16-sqs-fifo-lambda-mdx-73828e04760d3d58b33c.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2021-5-30-serverless-manage-resources-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2021-5-30-serverless-manage-resources-mdx-08a2aee63cb394e384f6.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2021-5-8-turn-express-app-to-lambda-cdk-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2021-5-8-turn-express-app-to-lambda-cdk-mdx-5d6f2333755f3450fc1b.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-12-18-nginx-proxy-server-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-12-18-nginx-proxy-server-mdx-cc8c9b594487643afd8b.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-2-13-talking-to-your-database-with-hasura-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-2-13-talking-to-your-database-with-hasura-mdx-6a00ab803de7f524a063.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-2-27-lambda-cold-start-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-2-27-lambda-cold-start-mdx-a3f1c5ccc3e43cc72e77.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-3-12-blue-green-deployment-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-3-12-blue-green-deployment-mdx-817cd51fb4d8bbaf3b43.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-3-5-database-migration-with-no-downtime-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2022-3-5-database-migration-with-no-downtime-mdx-32f15cf55dd36fa0b544.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-10-15-planning-vpc-cidr-block-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-10-15-planning-vpc-cidr-block-mdx-21a9033f5c92ca76896c.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-10-alive-again-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-10-alive-again-mdx-d5921bd52c3c3540d2e0.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-11-rancher-desktop-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-11-rancher-desktop-mdx-0e57184a854e5da97a8c.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-12-identify-the-boundaries-of-microservices-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-12-identify-the-boundaries-of-microservices-mdx-52f611843868e5eaca69.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-24-learned-a-few-things-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-6-24-learned-a-few-things-mdx-2842513c8a2f365476a2.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-7-2-one-rds-or-multiple-rds-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-7-2-one-rds-or-multiple-rds-mdx-81feee011fa64643ec04.js\"],\"component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-7-24-handling-related-data-microservice-mdx\":[\"/component---src-pages-post-mdx-fields-slug-tsx-content-file-path-posts-2023-7-24-handling-related-data-microservice-mdx-b5e7f59e9a9d5c6cb617.js\"],\"component---src-pages-tags-tsx\":[\"/component---src-pages-tags-tsx-2226e7404a3904bf5875.js\"],\"component---src-templates-blog-list-tsx\":[\"/component---src-templates-blog-list-tsx-819e57b5e8c5298d0210.js\"],\"component---src-templates-tag-tsx\":[\"/component---src-templates-tag-tsx-18058275f00df7523266.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="a7cf0c48995b7be33431";</script><script src="/webpack-runtime-52f4b62b7496e5660336.js" async></script><script src="/framework-59ae4113612e286a204c.js" async></script><script src="/app-889712e9418faa6c5175.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>